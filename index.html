<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Fluxo â€” Make Your Edits Flowww âœ¦ Abhiii</title>

<!-- Google fonts used -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&family=Montserrat:wght@400;700&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">

<!-- html2canvas for exporting -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
  :root{
    --bg-1:#071224; --bg-2:#0b2233;
    --accent:#60a5fa; --accent2:#a78bfa; --muted:#94a3b8;
    --glass: rgba(255,255,255,0.04);
    --card: rgba(255,255,255,0.03);
    --radius:14px;
    --text:#e6eef8;
    --accent-strong: #ff66b3;
  }
  /* Themeable variants (swapped by JS) */
  .theme-pink { --accent:#ff7ab6; --accent2:#ffb3d9; --card: rgba(255,255,255,0.03); --bg-1:#120417; --bg-2:#2b0a22; }
  .theme-green{ --accent:#34d399; --accent2:#60a5fa; --bg-1:#051214; --bg-2:#051f14;}
  .theme-dark{ --accent:#60a5fa; --accent2:#a78bfa; --bg-1:#071224; --bg-2:#0b2233; }
  .theme-golden{ --accent:#f59e0b; --accent2:#f97316; --bg-1:#0f0b05; --bg-2:#2b1f0b; }

  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial;color:var(--text);background:linear-gradient(180deg,var(--bg-1),var(--bg-2));-webkit-font-smoothing:antialiased}
  a{color:inherit}
  /* background canvas */
  canvas#bg { position:fixed; inset:0; z-index:0; display:block; }

  /* app container */
  .wrap{position:relative;z-index:2;min-height:100vh;display:flex;flex-direction:column;align-items:stretch;}
  header.hero{display:flex;align-items:center;justify-content:space-between;padding:28px 6vw 20px;gap:20px}
  .brand {font-family: "Playfair Display", serif; font-size:28px; background:linear-gradient(90deg,var(--accent),var(--accent2)); -webkit-background-clip:text; color:transparent; letter-spacing:0.6px}
  .tag {color:var(--muted); font-size:13px}
  .controls-top{display:flex;gap:12px;align-items:center}

  /* central content */
  .main { max-width:1200px; margin:18px auto; width:94%; display:grid; grid-template-columns: 1fr 420px; gap:24px; align-items:start; padding-bottom:40px}
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:var(--radius); padding:18px; box-shadow: 0 12px 30px rgba(0,0,0,0.45); border:1px solid rgba(255,255,255,0.03);}

  /* landing / entry */
  .landing{display:flex;flex-direction:column;gap:12px}
  .lead { font-size:20px; color:#dff3ff }
  .sublead { color:var(--muted); font-size:13px }

  .entry-buttons { display:flex; gap:12px; margin-top:10px }
  .btn { background:linear-gradient(90deg,var(--accent),var(--accent2)); border:none; color:#041025; padding:10px 14px; border-radius:10px; font-weight:700; cursor:pointer; box-shadow:0 8px 20px rgba(0,0,0,0.45) }
  .ghost { background:transparent; border:1px solid rgba(255,255,255,0.06); color:var(--text); padding:9px 12px; border-radius:10px; cursor:pointer }

  /* Theme selector */
  .theme-select { display:flex; gap:8px; align-items:center }
  .theme-dot { width:28px; height:28px; border-radius:8px; cursor:pointer; border:2px solid rgba(0,0,0,0.15) }

  /* Brat section - separate animated opening */
  .brat-shell { margin-top:18px }
  .brat-panel { overflow:hidden; border-radius:12px; position:relative }
  .brat-opening { display:flex; align-items:center; justify-content:space-between; gap:12px; padding:16px; cursor:pointer; transition:transform .28s; border-radius:12px }
  .brat-opening:hover { transform:translateY(-4px) }
  .brat-animated { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; pointer-events:none; opacity:0; transform:scale(.98); transition:all .45s ease }
  .brat-animated.show { opacity:1; transform:scale(1) }

  /* Brat editor */
  .brat-editor { display:grid; grid-template-columns: 1fr 380px; gap:14px; align-items:start; margin-top:12px }
  .preview { background:linear-gradient(180deg,rgba(0,0,0,0.18),transparent); border-radius:12px; height:360px; display:flex; align-items:center; justify-content:center; position:relative; overflow:hidden; }
  .preview canvas, .preview .previewLayer { width:100%; height:100%; display:block }
  .brat-controls { display:flex; flex-direction:column; gap:10px }
  .label{ font-size:13px; color:var(--muted); margin-bottom:6px;}
  input[type="text"], select { width:100%; padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,0.04); background:rgba(255,255,255,0.01); color:var(--text) }

  .swatches { display:flex; gap:8px; flex-wrap:wrap }
  .swatch { width:36px; height:36px; border-radius:8px; cursor:pointer; border:2px solid rgba(255,255,255,0.03) }

  .toggle { display:flex; gap:8px; align-items:center }
  .small-btn { padding:8px 10px; border-radius:8px; background:rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.03); cursor:pointer }

  .export-row { display:flex; gap:8px; margin-top:10px; align-items:center }

  /* Meme / editor studio (right column) */
  .studio { position:sticky; top:24px }
  .studio .canvas-wrap { height:360px; border-radius:12px; overflow:hidden; display:flex; align-items:center; justify-content:center; background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00)); border:1px solid rgba(255,255,255,0.02) }

  .layers { margin-top:12px; display:flex; flex-direction:column; gap:8px; max-height:200px; overflow:auto }

  .layer { display:flex; gap:8px; align-items:center; justify-content:space-between; padding:8px; background:rgba(255,255,255,0.02); border-radius:8px; border:1px solid rgba(255,255,255,0.02) }

  .filter-row { display:flex; gap:10px; margin-top:10px; align-items:center; flex-wrap:wrap }

  /* footer */
  footer.sitefoot { text-align:center; padding:22px 10px; color:var(--muted); border-top:1px solid rgba(255,255,255,0.02); margin-top:24px }

  /* small screens */
  @media(max-width:980px){
    .main { grid-template-columns:1fr; }
    .brat-editor { grid-template-columns: 1fr; }
    .studio { position:relative; top:auto }
  }

  /* utility */
  .muted{ color:var(--muted); font-size:13px }
  .tiny{ font-size:12px }

  /* Pro UI hints - keep subtle */
  .pro-badge { display:inline-block; padding:6px 10px; border-radius:8px; background:linear-gradient(90deg,#ffd166,#ff9f1c); color:#041025; font-weight:700; margin-left:8px; font-size:12px; }
  .locked { opacity:0.35; pointer-events:none; }
  .pro-control { display:flex; gap:8px; align-items:center }
  .unlock-btn { background:linear-gradient(90deg,#ffd166,#ff9f1c); padding:8px 12px; border-radius:10px; color:#041025; border:none; cursor:pointer; font-weight:700 }
</style>
</head>
<body class="theme-dark">

<!-- background canvas -->
<canvas id="bg"></canvas>

<div class="wrap">
  <header class="hero">
    <div>
      <div class="brand">Fluxo <span style="font-weight:400; font-size:12px; color:var(--muted)">âœ¦ make your edits flowww</span></div>
      <div class="tag muted">Crafted with ðŸ’– by Abhiii â€” for the meme geeks</div>
    </div>

    <div class="controls-top">
      <div class="theme-select">
        <div class="muted tiny" style="margin-right:8px">Themes</div>
        <div class="theme-dot" title="Pink" style="background:linear-gradient(90deg,#ff7ab6,#ffb3d9)" data-theme="theme-pink"></div>
        <div class="theme-dot" title="Green" style="background:linear-gradient(90deg,#34d399,#60a5fa)" data-theme="theme-green"></div>
        <div class="theme-dot" title="Dark" style="background:linear-gradient(90deg,#60a5fa,#a78bfa)" data-theme="theme-dark"></div>
        <div class="theme-dot" title="Golden" style="background:linear-gradient(90deg,#f59e0b,#f97316)" data-theme="theme-golden"></div>
      </div>
      <button class="ghost" id="open-brat">Open Brat Lab</button>
      <button class="btn" id="goto-studio">Open Edit Studio</button>
    </div>
  </header>

  <main class="main">
    <!-- LEFT: Landing + Brat -->
    <div>
      <div class="card landing">
        <div class="lead">Fluxo â€” Brat Lab & Meme Studio</div>
        <div class="sublead">Create trendy brat text art, and powerful meme edits â€” professional UI, local export, responsive.</div>
      </div>

      <!-- BRAT Shell -->
      <div class="card brat-shell" id="brat-shell">
        <div class="brat-panel">
          <!-- opening bar -->
          <div class="brat-opening" id="brat-opening">
            <div>
              <div style="font-weight:700">Brat Generator Lab</div>
              <div class="muted tiny">Animated text art â€” fonts, colors, glow & export</div>
            </div>
            <div class="muted tiny">Click to open</div>
          </div>

          <!-- animated decorative layer -->
          <div class="brat-animated" id="brat-anim">
            <!-- subtle animated glow circles -->
            <svg width="320" height="120" viewBox="0 0 320 120" fill="none" aria-hidden>
              <defs>
                <linearGradient id="g1" x1="0" x2="1">
                  <stop offset="0" stop-color="rgba(255,255,255,0.06)"/>
                  <stop offset="1" stop-color="transparent"/>
                </linearGradient>
              </defs>
              <rect x="0" y="10" width="320" height="100" rx="12" fill="url(#g1)"></rect>
            </svg>
          </div>

          <!-- editor (hidden until open) -->
          <div id="brat-editor" style="display:none; padding:14px;">
            <div class="brat-editor">
              <!-- left: live preview -->
              <div>
                <div class="label">Live Preview</div>
                <div class="preview" id="brat-preview">
                  <div id="previewLayer" style="pointer-events:none; display:flex; align-items:center; justify-content:center; text-align:center; padding:20px;">
                    <canvas id="bratCanvas" width="800" height="360"></canvas>
                  </div>
                </div>

                <div style="display:flex; gap:8px; margin-top:8px; align-items:center">
                  <button class="small-btn" id="brat-random">Random</button>
                  <button class="small-btn" id="brat-generate">Generate (screenshot)</button>
                  <div class="muted tiny" style="margin-left:auto">Watermark: Fluxo âœ¦ Abhiii</div>
                </div>
              </div>

              <!-- right: controls -->
              <div class="brat-controls">
                <div>
                  <div class="label">Text</div>
                  <input type="text" id="bratText" placeholder="Type your brat line â€” e.g., 'itâ€™s giving main character vibes ðŸ’…'">
                </div>

                <div>
                  <div class="label">Font</div>
                  <select id="bratFont">
                    <option value="48px Inter">Inter (clean)</option>
                    <option value="56px 'Playfair Display'">Playfair (elegant)</option>
                    <option value="54px 'Montserrat'">Montserrat (bold)</option>
                    <option value="48px 'Courier New'">Mono (retro)</option>
                    <option value="56px 'Segoe UI'">Segoe UI</option>
                  </select>
                </div>

                <div>
                  <div class="label">Color</div>
                  <div class="swatches" id="bratColors">
                    <div class="swatch" style="background:linear-gradient(90deg,#ff7ab6,#ffb3d9)" data-color="#ffe6f0"></div>
                    <div class="swatch" style="background:linear-gradient(90deg,#60a5fa,#a78bfa)" data-color="#e6f0ff"></div>
                    <div class="swatch" style="background:linear-gradient(90deg,#34d399,#60a5fa)" data-color="#eafaf1"></div>
                    <div class="swatch" style="background:linear-gradient(90deg,#ffd166,#ff9f1c)" data-color="#fff3e0"></div>
                    <div class="swatch" style="background:linear-gradient(90deg,#0f172a,#1e293b)" data-color="#e6eef8"></div>
                  </div>
                </div>

                <div>
                  <div class="label">Background (free)</div>
                  <div class="swatches" id="bratBgSwatches">
                    <div class="swatch" style="background:linear-gradient(90deg,#fff3f8,#ffe6f0)" data-bg="linear-gradient(90deg,#fff3f8,#ffe6f0)"></div>
                    <div class="swatch" style="background:linear-gradient(90deg,#e6f0ff,#eff6ff)" data-bg="linear-gradient(90deg,#e6f0ff,#eff6ff)"></div>
                    <div class="swatch" style="background:linear-gradient(90deg,#f1f5f9,#e2e8f0)" data-bg="linear-gradient(90deg,#f1f5f9,#e2e8f0)"></div>
                    <div class="swatch" style="background:linear-gradient(90deg,#161616,#0b0b0b)" data-bg="linear-gradient(90deg,#161616,#0b0b0b)"></div>
                  </div>

                  <!-- Pro backgrounds (hidden until unlock) -->
                  <div style="margin-top:8px" class="muted tiny">Pro backgrounds (unlock):</div>
                  <div class="swatches" id="proBgSwatches" style="margin-top:8px; opacity:0.3; pointer-events:none;">
                    <!-- pro items (initially locked) -->
                    <div class="swatch" style="background:linear-gradient(90deg,#ff9fb7,#ffc8d9)" data-bg="linear-gradient(90deg,#ff9fb7,#ffc8d9)"></div>
                    <div class="swatch" style="background:linear-gradient(90deg,#bde6a9,#34d399)" data-bg="linear-gradient(90deg,#bde6a9,#34d399)"></div>
                    <div class="swatch" style="background:linear-gradient(90deg,#fdf2c3,#ffd166)" data-bg="linear-gradient(90deg,#fdf2c3,#ffd166)"></div>
                    <div class="swatch" style="background:linear-gradient(90deg,#f3e6ff,#d6bbff)" data-bg="linear-gradient(90deg,#f3e6ff,#d6bbff)"></div>
                  </div>

                  <div style="margin-top:8px" class="pro-control">
                    <button class="unlock-btn" id="unlockProBtn">Unlock Pro</button>
                    <div id="proStatus" class="muted tiny">Pro locked</div>
                    <div id="dailyInfo" class="muted tiny" style="margin-left:auto">Today's usage: 0/2</div>
                  </div>
                </div>

                <div>
                  <div class="label">Effects</div>
                  <div class="toggle">
                    <label><input type="checkbox" id="bratGlow"> Glow</label>
                    <label><input type="checkbox" id="bratOutline"> Outline</label>
                    <label><input type="checkbox" id="bratShadow"> Shadow</label>
                  </div>
                </div>

                <div style="margin-top:auto">
                  <div class="label">Size / Align</div>
                  <div style="display:flex; gap:8px">
                    <input id="bratSize" type="range" min="28" max="120" value="56" />
                    <select id="bratAlign">
                      <option value="center">Center</option>
                      <option value="left">Left</option>
                      <option value="right">Right</option>
                    </select>
                  </div>
                </div>

              </div>
            </div>
          </div>

        </div>
      </div>

      <!-- extra informational card -->
      <div class="card" style="margin-top:14px">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div style="font-weight:700">Fluxo Labs</div>
            <div class="muted tiny">Pro features, local export, responsive UI â€” no backend required</div>
          </div>
          <div class="muted tiny">Version v3.5</div>
        </div>
      </div>
    </div>

    <!-- RIGHT: Studio -->
    <aside class="card studio">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div style="font-weight:700">Meme / Edit Studio</div>
        <div class="muted tiny">Upload â†’ Edit â†’ Export</div>
      </div>

      <div style="height:12px"></div>

      <div class="canvas-wrap" id="studioCanvasWrap">
        <div id="studioArea" style="width:100%; height:100%; position:relative; display:flex; align-items:center; justify-content:center; overflow:hidden; background:linear-gradient(180deg, rgba(0,0,0,0.12), rgba(0,0,0,0.02))">
          <canvas id="studioCanvas" width="800" height="360" style="max-width:100%; border-radius:12px;"></canvas>
        </div>
      </div>

      <div style="margin-top:12px; display:flex; gap:8px; align-items:center; justify-content:space-between">
        <div style="display:flex; gap:8px">
          <button class="small-btn" id="addTextBtn">Add Text</button>
          <button class="small-btn" id="exportStudio" disabled>Export (studio locked)</button>
        </div>
        <div class="muted tiny">Studio features coming soon</div>
      </div>

      <div class="layers" id="layers"></div>

      <div style="margin-top:12px">
        <div class="label">Filters</div>
        <div class="filter-row">
          <label class="tiny muted">Brightness <input type="range" id="fBrightness" min="50" max="150" value="100"></label>
          <label class="tiny muted">Contrast <input type="range" id="fContrast" min="50" max="150" value="100"></label>
          <label class="tiny muted">Saturation <input type="range" id="fSaturate" min="0" max="200" value="100"></label>
          <label class="tiny muted">Blur <input type="range" id="fBlur" min="0" max="6" value="0"></label>
        </div>
      </div>

    </aside>

  </main>

  <footer class="sitefoot">crafted with ðŸ’– by Abhiii for the meme geeks</footer>
</div>

<!-- Password prompt modal (simple) -->
<div id="pwModal" style="position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.5);z-index:6000">
  <div style="background:linear-gradient(180deg,#fff,#f7f7f7);padding:18px;border-radius:12px;width:320px;text-align:center;">
    <div style="font-weight:700;color:#041025;margin-bottom:8px">Enter Pro Password</div>
    <input id="pwInput" type="password" placeholder="Password" style="width:100%;padding:10px;border-radius:8px;border:1px solid #ddd;margin-bottom:10px">
    <div style="display:flex;gap:8px;justify-content:center">
      <button id="pwCancel" style="padding:8px 12px;border-radius:8px;border:none;background:#eee;cursor:pointer">Cancel</button>
      <button id="pwSubmit" style="padding:8px 12px;border-radius:8px;border:none;background:linear-gradient(90deg,#ffd166,#ff9f1c);cursor:pointer;font-weight:700">Unlock</button>
    </div>
    <div id="pwMsg" style="color:#aa0000;margin-top:8px;font-size:13px"></div>
  </div>
</div>

<script>
/* ==========================
   Background particles (optimized)
   ========================== */
const bg = document.getElementById('bg');
const bgCtx = bg.getContext('2d');
let DPR = Math.max(1, window.devicePixelRatio || 1);
function resizeBg(){
  DPR = Math.max(1, window.devicePixelRatio || 1);
  bg.width = innerWidth * DPR; bg.height = innerHeight * DPR;
  bg.style.width = innerWidth + 'px'; bg.style.height = innerHeight + 'px';
  bgCtx.setTransform(DPR,0,0,DPR,0,0);
}
window.addEventListener('resize', resizeBg);
resizeBg();
const PCOUNT = Math.max(24, Math.floor((innerWidth*innerHeight)/180000));
const PARTS = [];
for(let i=0;i<PCOUNT;i++){
  PARTS.push({x:Math.random()*innerWidth, y:Math.random()*innerHeight, r:1+Math.random()*2.6, vx:(Math.random()-0.5)*0.3, vy:(Math.random()-0.5)*0.3, hue:200+Math.random()*140});
}
let mouse = {x:innerWidth/2, y:innerHeight/2};
window.addEventListener('mousemove', e => { mouse.x = e.clientX; mouse.y = e.clientY; });
function drawBg(){
  bgCtx.clearRect(0,0,innerWidth,innerHeight);
  // gradient overlay
  const g = bgCtx.createLinearGradient(0,0,innerWidth,innerHeight);
  g.addColorStop(0, 'rgba(6,12,24,0.08)'); g.addColorStop(1,'rgba(12,30,46,0.12)');
  bgCtx.fillStyle = g; bgCtx.fillRect(0,0,innerWidth,innerHeight);

  for(let p of PARTS){
    p.x += p.vx + (mouse.x - p.x) * 0.0006;
    p.y += p.vy + (mouse.y - p.y) * 0.0006;
    if(p.x < -50) p.x = innerWidth + 50; if(p.x > innerWidth + 50) p.x = -50;
    if(p.y < -50) p.y = innerHeight + 50; if(p.y > innerHeight + 50) p.y = -50;

    const gr = bgCtx.createRadialGradient(p.x,p.y,0,p.x,p.y,p.r*12);
    gr.addColorStop(0, 'rgba(167,139,250,0.08)'); gr.addColorStop(1, 'rgba(96,165,250,0.01)');
    bgCtx.fillStyle = gr;
    bgCtx.beginPath(); bgCtx.arc(p.x,p.y,p.r,0,Math.PI*2); bgCtx.fill();
  }

  // light connections
  for(let i=0;i<PARTS.length;i++){
    for(let j=i+1;j<PARTS.length;j++){
      const a=PARTS[i], b=PARTS[j]; const dx=a.x-b.x, dy=a.y-b.y; const d=Math.sqrt(dx*dx+dy*dy);
      if(d<120){
        bgCtx.beginPath();
        bgCtx.strokeStyle = `rgba(100,140,200,${(120-d)/220})`; bgCtx.lineWidth=0.5;
        bgCtx.moveTo(a.x,a.y); bgCtx.lineTo(b.x,b.y); bgCtx.stroke();
      }
    }
  }

  requestAnimationFrame(drawBg);
}
requestAnimationFrame(drawBg);

/* ==========================
   Theme selector
   ========================== */
document.querySelectorAll('.theme-dot').forEach(el=>{
  el.addEventListener('click', ()=> {
    const theme = el.dataset.theme;
    document.body.className = theme;
  });
});

/* ==========================
   Brat lab logic (canvas text rendering + export)
   ========================== */
const bratOpenBtn = document.getElementById('brat-opening');
const bratEditor = document.getElementById('brat-editor');
const bratAnim = document.getElementById('brat-anim');
const bratCanvas = document.getElementById('bratCanvas');
const bCtx = bratCanvas.getContext('2d');
const bratText = document.getElementById('bratText');
const bratFont = document.getElementById('bratFont');
const bratColors = document.getElementById('bratColors');
const bratBgSwatches = document.getElementById('bratBgSwatches');
const proBgSwatches = document.getElementById('proBgSwatches');
const bratSize = document.getElementById('bratSize');
const bratAlign = document.getElementById('bratAlign');
const bratGlow = document.getElementById('bratGlow');
const bratOutline = document.getElementById('bratOutline');
const bratShadow = document.getElementById('bratShadow');
const bratGenerate = document.getElementById('brat-generate');
const bratRandom = document.getElementById('brat-random');
const proStatusEl = document.getElementById('proStatus');
const dailyInfoEl = document.getElementById('dailyInfo');
const unlockProBtn = document.getElementById('unlockProBtn');

let bratConfig = {
  text: "itâ€™s giving main character vibes ðŸ’…",
  font: bratFont.value,
  color: "#ffe6f0",
  bg: "linear-gradient(90deg,#fff3f8,#ffe6f0)",
  size: Number(bratSize.value),
  align: 'center',
  glow:false, outline:false, shadow:false
};

/* ---------- helper: draw current preview ---------- */
function drawBratPreview(){
  // clear
  bCtx.clearRect(0,0,bratCanvas.width,bratCanvas.height);

  // background (simple linear gradient parser)
  try {
    bCtx.save();
    // fill with CSS gradient attempt: fallback to solid
    bCtx.fillStyle = "#0b1220";
    bCtx.fillRect(0,0,bratCanvas.width, bratCanvas.height);
    // use an offscreen div for accurate gradient fill would be heavy; keep simple: fillRect + overlay
    // Draw a lightweight gradient approximation
    const g = bCtx.createLinearGradient(0,0,bratCanvas.width, bratCanvas.height);
    if(bratConfig.bg.includes('linear-gradient')) {
      // derive two colors by splitting parentheses
      const m = bratConfig.bg.match(/linear-gradient\([^,]+,([^,]+),\s*([^\)]+)\)/);
      if(m){
        g.addColorStop(0, m[1].trim());
        g.addColorStop(1, m[2].trim());
      } else {
        g.addColorStop(0, '#fff'); g.addColorStop(1, '#eee');
      }
    } else {
      g.addColorStop(0, bratConfig.bg); g.addColorStop(1, bratConfig.bg);
    }
    bCtx.fillStyle = g;
    bCtx.fillRect(0,0,bratCanvas.width, bratCanvas.height);
    bCtx.restore();
  } catch(e){/* ignore gradient render errors */ }

  // text
  const fontSize = bratConfig.size || 56;
  bCtx.font = `${fontSize}px ${bratConfig.font.split(' ').slice(-1)[0] || 'Inter'}`;
  bCtx.textAlign = bratConfig.align;
  bCtx.fillStyle = bratConfig.color || '#fff';

  // effects
  if(bratConfig.shadow){
    bCtx.shadowColor = 'rgba(0,0,0,0.6)';
    bCtx.shadowBlur = 16;
    bCtx.shadowOffsetY = 6;
  } else {
    bCtx.shadowColor = 'transparent';
    bCtx.shadowBlur = 0;
  }

  // outline
  if(bratConfig.outline){
    bCtx.lineWidth = 6;
    bCtx.strokeStyle = 'rgba(0,0,0,0.35)';
    if(bratConfig.align === 'center'){
      bCtx.strokeText(bratConfig.text, bratCanvas.width/2, bratCanvas.height/2 + fontSize/3);
      bCtx.fillText(bratConfig.text, bratCanvas.width/2, bratCanvas.height/2 + fontSize/3);
    } else if(bratConfig.align === 'left'){
      bCtx.strokeText(bratConfig.text, 40, bratCanvas.height/2 + fontSize/3);
      bCtx.fillText(bratConfig.text, 40, bratCanvas.height/2 + fontSize/3);
    } else {
      bCtx.strokeText(bratConfig.text, bratCanvas.width-40, bratCanvas.height/2 + fontSize/3);
      bCtx.fillText(bratConfig.text, bratCanvas.width-40, bratCanvas.height/2 + fontSize/3);
    }
  } else {
    if(bratConfig.align === 'center'){
      bCtx.fillText(bratConfig.text, bratCanvas.width/2, bratCanvas.height/2 + fontSize/3);
    } else if(bratConfig.align === 'left'){
      bCtx.fillText(bratConfig.text, 40, bratCanvas.height/2 + fontSize/3);
    } else {
      bCtx.fillText(bratConfig.text, bratCanvas.width-40, bratCanvas.height/2 + fontSize/3);
    }
  }

  // glow (simple radial)
  if(bratConfig.glow){
    const grd = bCtx.createRadialGradient(bratCanvas.width/2, bratCanvas.height/2, fontSize/2, bratCanvas.width/2, bratCanvas.height/2, fontSize*2);
    grd.addColorStop(0, bratConfig.color + '55');
    grd.addColorStop(1, 'rgba(255,255,255,0)');
    bCtx.globalCompositeOperation = 'lighter';
    bCtx.fillStyle = grd;
    bCtx.fillRect(0,0,bratCanvas.width, bratCanvas.height);
    bCtx.globalCompositeOperation = 'source-over';
  }
}

function commitConfigFromUI(){
  bratConfig.text = bratText.value || bratConfig.text;
  bratConfig.font = bratFont.value;
  bratConfig.size = Number(bratSize.value);
  bratConfig.align = bratAlign.value;
  bratConfig.glow = bratGlow.checked;
  bratConfig.outline = bratOutline.checked;
  bratConfig.shadow = bratShadow.checked;
}

bratText.addEventListener('input', ()=> { bratConfig.text = bratText.value; drawBratPreview(); });
bratFont.addEventListener('change', ()=> { bratConfig.font = bratFont.value; drawBratPreview(); });
bratSize.addEventListener('input', ()=> { bratConfig.size = Number(bratSize.value); drawBratPreview(); });
bratAlign.addEventListener('change', ()=> { bratConfig.align = bratAlign.value; drawBratPreview(); });
bratGlow.addEventListener('change', ()=> { bratConfig.glow = bratGlow.checked; drawBratPreview(); });
bratOutline.addEventListener('change', ()=> { bratConfig.outline = bratOutline.checked; drawBratPreview(); });
bratShadow.addEventListener('change', ()=> { bratConfig.shadow = bratShadow.checked; drawBratPreview(); });

/* swatches (colors) */
document.querySelectorAll('#bratColors .swatch').forEach(s=>{
  s.addEventListener('click', ()=> {
    bratConfig.color = s.dataset.color;
    drawBratPreview();
  });
});

/* free BG swatches */
bratBgSwatches.querySelectorAll('.swatch').forEach(s=>{
  s.addEventListener('click', ()=> {
    bratConfig.bg = s.dataset.bg;
    drawBratPreview();
  });
});

/* pro BG swatches â€” initially locked */
proBgSwatches.querySelectorAll('.swatch').forEach(s=>{
  s.addEventListener('click', ()=> {
    if(!isProActiveToday()) { alert('Pro backgrounds locked â€” unlock Pro to use.'); return; }
    bratConfig.bg = s.dataset.bg;
    drawBratPreview();
  });
});

/* random */
bratRandom.addEventListener('click', ()=>{
  const texts = [
    "itâ€™s giving main character vibes ðŸ’…",
    "mood: quietly plotting success",
    "I speak fluent chaos and coffee",
    "main character energy (loading...)",
    "soft girl but with code energy",
    "donâ€™t touch my vibe, itâ€™s copyrighted"
  ];
  bratText.value = texts[Math.floor(Math.random()*texts.length)];
  bratConfig.text = bratText.value;
  drawBratPreview();
});

/* open/close */
document.getElementById('open-brat').addEventListener('click', ()=> {
  document.getElementById('brat-editor').style.display = 'block';
  bratAnim.classList.add('show');
  setTimeout(()=> { drawBratPreview(); }, 150);
});

/* ==========================
   Daily limits & Pro unlock logic
   ========================== */

// Utility: get local YYYY-MM-DD
function todayKey(){ const d=new Date(); return d.getFullYear()+'-'+(d.getMonth()+1).toString().padStart(2,'0')+'-'+d.getDate().toString().padStart(2,'0'); }

function getDailyUsage(){
  const key = 'fluxo_brat_usage_' + todayKey();
  const v = parseInt(localStorage.getItem(key) || '0', 10);
  return {key, count: v};
}
function incrementDailyUsage(){
  const o = getDailyUsage();
  localStorage.setItem(o.key, String(o.count + 1));
  updateDailyInfo();
}
function resetDailyUsageIfNewDay(){ /* handled by using todayKey */ }
function updateDailyInfo(){
  const o = getDailyUsage();
  dailyInfoEl.textContent = `Today's usage: ${o.count}/2`;
}

/* Obfuscated password: we store XORed char codes with a key to avoid leaving plain text in code.
   This is a simple obfuscation (not cryptographically secure), per your request.
   Password (plain): ABHIJEET0123
   XOR key used: 42
*/
const obfArray = [11, 34, 2, 35, 15, 15, 95, 127, 103, 91, 118, 89]; // each element = charCode ^ 42

function decodePassword(){
  let s='';
  for(let n of obfArray) s += String.fromCharCode(n ^ 42);
  return s;
}

function isProActiveToday(){
  const day = todayKey();
  const val = JSON.parse(localStorage.getItem('fluxo_pro') || '{}');
  return val.day === day && val.unlocked === true;
}

function setProActiveToday(){
  const day = todayKey();
  localStorage.setItem('fluxo_pro', JSON.stringify({ day, unlocked:true }));
  refreshProUI();
}

function clearPro(){
  localStorage.removeItem('fluxo_pro');
  refreshProUI();
}

function refreshProUI(){
  const active = isProActiveToday();
  if(active){
    proStatusEl.textContent = 'Pro unlocked (today)';
    proBgSwatches.style.opacity = '1';
    proBgSwatches.style.pointerEvents = 'auto';
    unlockProBtn.style.display = 'none';
  } else {
    proStatusEl.textContent = 'Pro locked';
    proBgSwatches.style.opacity = '0.35';
    proBgSwatches.style.pointerEvents = 'none';
    unlockProBtn.style.display = 'inline-block';
  }
  updateDailyInfo();
}

/* Password modal flow */
const pwModal = document.getElementById('pwModal');
const pwInput = document.getElementById('pwInput');
const pwSubmit = document.getElementById('pwSubmit');
const pwCancel = document.getElementById('pwCancel');
const pwMsg = document.getElementById('pwMsg');

unlockProBtn.addEventListener('click', ()=> {
  pwInput.value = '';
  pwMsg.textContent = '';
  pwModal.style.display = 'flex';
  pwInput.focus();
});
pwCancel.addEventListener('click', ()=> { pwModal.style.display = 'none'; });
pwSubmit.addEventListener('click', ()=> {
  const entered = pwInput.value || '';
  const real = decodePassword();
  if(entered === real){
    setProActiveToday();
    pwModal.style.display = 'none';
    alert('Pro unlocked for today âœ…');
  } else {
    pwMsg.textContent = 'Wrong password';
  }
});

/* ==========================
   Generate/export behavior (2/day free, unlimited when pro)
   - When user clicks "Generate", UI will hide controls and show only the clean brat canvas, then capture with html2canvas and download.
   - If free limit exhausted, prompt for unlock.
   ========================== */

async function generateBratImage(){
  // check pro or daily limit
  if(!isProActiveToday()){
    const usage = getDailyUsage();
    if(usage.count >= 2){
      // ask to unlock
      if(!confirm('You reached the daily free limit (2). Unlock Pro for unlimited generation?')) return;
      // show modal to unlock
      unlockProBtn.click();
      return;
    }
  }

  // proceed to generate
  // temporarily hide UI elements to get a clean screenshot of the canvas only
  const editor = document.getElementById('brat-editor');
  const controls = document.querySelectorAll('#brat-editor .brat-controls, #brat-editor .small-btn, #brat-editor .label, #brat-editor .swatches, #brat-editor .toggle, #brat-editor .brat-size');
  // hide non-preview elements
  const toHide = [];
  editor.querySelectorAll('*').forEach(el => {
    if(!el.closest('#brat-preview') && el.id !== 'brat-preview' && el.id !== 'bratCanvas') {
      if(el.style) { toHide.push(el); el.style.display = 'none'; }
    }
  });

  // wait a tick so layout updates
  await new Promise(r => setTimeout(r, 80));

  // use html2canvas to capture the preview layer (bratCanvas)
  try {
    const canvas = document.getElementById('bratCanvas');
    // create a clean canvas copy at full resolution
    const exportCanvas = document.createElement('canvas');
    exportCanvas.width = canvas.width;
    exportCanvas.height = canvas.height;
    const ec = exportCanvas.getContext('2d');
    // draw background (copy)
    ec.drawImage(canvas, 0, 0);
    // download
    exportCanvas.toBlob(blob => {
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      const ts = Date.now();
      a.download = `fluxo_brat_${ts}.png`;
      document.body.appendChild(a);
      a.click();
      a.remove();
    }, 'image/png');

    // increment daily usage if not pro
    if(!isProActiveToday()){
      incrementDailyUsage();
    }

  } catch(err){
    console.error('Export error', err);
    alert('Export failed. Try again.');
  } finally {
    // restore UI
    toHide.forEach(el => el.style.display = '');
  }
}

/* wire up generate button */
bratGenerate.addEventListener('click', async ()=>{
  commitConfigFromUI();
  drawBratPreview();
  await generateBratImage();
});

/* initial UI */
refreshProUI();
updateDailyInfo();

/* ==========================
   Small misc: studio canvas placeholder (kept minimal as requested)
   ========================== */
const studioCanvas = document.getElementById('studioCanvas');
const sCtx = studioCanvas.getContext('2d');
sCtx.fillStyle = '#0f172a';
sCtx.fillRect(0,0,studioCanvas.width, studioCanvas.height);
sCtx.fillStyle = '#8aa5d6';
sCtx.font = '18px Inter';
sCtx.fillText('Fluxo Studio (coming soon)', 20, 40);

/* addTextBtn sample */
document.getElementById('addTextBtn').addEventListener('click', ()=> {
  alert('Studio text tool coming soon â€” the Brat Lab is active for now.');
});

/* exportStudio locked */
document.getElementById('exportStudio').addEventListener('click', ()=> {
  alert('Studio export locked in this demo. Use Brat Lab generate for now.');
});

/* init default preview values */
bratText.value = bratConfig.text;
drawBratPreview();

</script>
</body>
</html>
