<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Fluxo â€” Make Your Edits Flowww âœ¦ Abhiii</title>

<!-- Google fonts used -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&family=Montserrat:wght@400;700&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">

<!-- html2canvas for exporting -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
  :root{
    --bg-1:#071224; --bg-2:#0b2233;
    --accent:#60a5fa; --accent2:#a78bfa; --muted:#94a3b8;
    --glass: rgba(255,255,255,0.04);
    --card: rgba(255,255,255,0.03);
    --radius:14px;
    --text:#e6eef8;
    --accent-strong: #ff66b3;
  }
  /* Themeable variants (swapped by JS) */
  .theme-pink { --accent:#ff7ab6; --accent2:#ffb3d9; --card: rgba(255,255,255,0.03); --bg-1:#120417; --bg-2:#2b0a22; }
  .theme-green{ --accent:#34d399; --accent2:#60a5fa; --bg-1:#051214; --bg-2:#051f14;}
  .theme-dark{ --accent:#60a5fa; --accent2:#a78bfa; --bg-1:#071224; --bg-2:#0b2233; }
  .theme-golden{ --accent:#f59e0b; --accent2:#f97316; --bg-1:#0f0b05; --bg-2:#2b1f0b; }

  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial;color:var(--text);background:linear-gradient(180deg,var(--bg-1),var(--bg-2));-webkit-font-smoothing:antialiased}
  a{color:inherit}
  /* background canvas */
  canvas#bg { position:fixed; inset:0; z-index:0; display:block; }

  /* app container */
  .wrap{position:relative;z-index:2;min-height:100vh;display:flex;flex-direction:column;align-items:stretch;}
  header.hero{display:flex;align-items:center;justify-content:space-between;padding:28px 6vw 20px;gap:20px}
  .brand {font-family: "Playfair Display", serif; font-size:28px; background:linear-gradient(90deg,var(--accent),var(--accent2)); -webkit-background-clip:text; color:transparent; letter-spacing:0.6px}
  .tag {color:var(--muted); font-size:13px}
  .controls-top{display:flex;gap:12px;align-items:center}

  /* central content */
  .main { max-width:1200px; margin:18px auto; width:94%; display:grid; grid-template-columns: 1fr 420px; gap:24px; align-items:start; padding-bottom:40px}
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:var(--radius); padding:18px; box-shadow: 0 12px 30px rgba(0,0,0,0.45); border:1px solid rgba(255,255,255,0.03);}

  /* landing / entry */
  .landing{display:flex;flex-direction:column;gap:12px}
  .lead { font-size:20px; color:#dff3ff }
  .sublead { color:var(--muted); font-size:13px }

  .entry-buttons { display:flex; gap:12px; margin-top:10px }
  .btn { background:linear-gradient(90deg,var(--accent),var(--accent2)); border:none; color:#041025; padding:10px 14px; border-radius:10px; font-weight:700; cursor:pointer; box-shadow:0 8px 20px rgba(0,0,0,0.45) }
  .ghost { background:transparent; border:1px solid rgba(255,255,255,0.06); color:var(--text); padding:9px 12px; border-radius:10px; cursor:pointer }

  /* Theme selector */
  .theme-select { display:flex; gap:8px; align-items:center }
  .theme-dot { width:28px; height:28px; border-radius:8px; cursor:pointer; border:2px solid rgba(0,0,0,0.15) }

  /* Brat section - separate animated opening */
  .brat-shell { margin-top:18px }
  .brat-panel { overflow:hidden; border-radius:12px; position:relative }
  .brat-opening { display:flex; align-items:center; justify-content:space-between; gap:12px; padding:16px; cursor:pointer; transition:transform .28s; border-radius:12px }
  .brat-opening:hover { transform:translateY(-4px) }
  .brat-animated { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; pointer-events:none; opacity:0; transform:scale(.98); transition:all .45s ease }
  .brat-animated.show { opacity:1; transform:scale(1) }

  /* Brat editor */
  .brat-editor { display:grid; grid-template-columns: 1fr 380px; gap:14px; align-items:start; margin-top:12px }
  .preview { background:linear-gradient(180deg,rgba(0,0,0,0.18),transparent); border-radius:12px; height:360px; display:flex; align-items:center; justify-content:center; position:relative; overflow:hidden; }
  .preview canvas, .preview .previewLayer { width:100%; height:100%; display:block }
  .brat-controls { display:flex; flex-direction:column; gap:10px }
  .label{ font-size:13px; color:var(--muted); margin-bottom:6px;}
  input[type="text"], select { width:100%; padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,0.04); background:rgba(255,255,255,0.01); color:var(--text) }

  .swatches { display:flex; gap:8px; flex-wrap:wrap }
  .swatch { width:36px; height:36px; border-radius:8px; cursor:pointer; border:2px solid rgba(255,255,255,0.03) }

  .toggle { display:flex; gap:8px; align-items:center }
  .small-btn { padding:8px 10px; border-radius:8px; background:rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.03); cursor:pointer }

  .export-row { display:flex; gap:8px; margin-top:10px; align-items:center }

  /* Meme / editor studio (right column) */
  .studio { position:sticky; top:24px }
  .studio .canvas-wrap { height:360px; border-radius:12px; overflow:hidden; display:flex; align-items:center; justify-content:center; background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00)); border:1px solid rgba(255,255,255,0.02) }
  .studio input[type=file]{ display:none }
  .studio .upload-btn { display:inline-flex; gap:8px; padding:10px 12px; border-radius:10px; background:linear-gradient(90deg,var(--accent),var(--accent2)); color:#041025; font-weight:700; cursor:pointer; }

  .layers { margin-top:12px; display:flex; flex-direction:column; gap:8px; max-height:200px; overflow:auto }

  .layer { display:flex; gap:8px; align-items:center; justify-content:space-between; padding:8px; background:rgba(255,255,255,0.02); border-radius:8px; border:1px solid rgba(255,255,255,0.02) }

  .filter-row { display:flex; gap:10px; margin-top:10px; align-items:center; flex-wrap:wrap }

  /* footer */
  footer.sitefoot { text-align:center; padding:22px 10px; color:var(--muted); border-top:1px solid rgba(255,255,255,0.02); margin-top:24px }

  /* small screens */
  @media(max-width:980px){
    .main { grid-template-columns:1fr; }
    .brat-editor { grid-template-columns: 1fr; }
    .studio { position:relative; top:auto }
  }

  /* utility */
  .muted{ color:var(--muted); font-size:13px }
  .tiny{ font-size:12px }
</style>
</head>
<body class="theme-dark">

<!-- background canvas -->
<canvas id="bg"></canvas>

<div class="wrap">
  <header class="hero">
    <div>
      <div class="brand">Fluxo <span style="font-weight:400; font-size:12px; color:var(--muted)">âœ¦ make your edits flowww</span></div>
      <div class="tag muted">Crafted with ðŸ’– by Abhiii â€” for the meme geeks</div>
    </div>

    <div class="controls-top">
      <div class="theme-select">
        <div class="muted tiny" style="margin-right:8px">Themes</div>
        <div class="theme-dot" title="Pink" style="background:linear-gradient(90deg,#ff7ab6,#ffb3d9)" data-theme="theme-pink"></div>
        <div class="theme-dot" title="Green" style="background:linear-gradient(90deg,#34d399,#60a5fa)" data-theme="theme-green"></div>
        <div class="theme-dot" title="Dark" style="background:linear-gradient(90deg,#60a5fa,#a78bfa)" data-theme="theme-dark"></div>
        <div class="theme-dot" title="Golden" style="background:linear-gradient(90deg,#f59e0b,#f97316)" data-theme="theme-golden"></div>
      </div>
      <button class="ghost" id="open-brat">Open Brat Lab</button>
      <button class="btn" id="goto-studio">Open Edit Studio</button>
    </div>
  </header>

  <main class="main">
    <!-- LEFT: Landing + Brat -->
    <div>
      <div class="card landing">
        <div class="lead">Fluxo â€” Brat Lab & Meme Studio</div>
        <div class="sublead">Create trendy brat text art, and powerful meme edits â€” professional UI, local export, responsive.</div>
      </div>

      <!-- BRAT Shell -->
      <div class="card brat-shell" id="brat-shell">
        <div class="brat-panel">
          <!-- opening bar -->
          <div class="brat-opening" id="brat-opening">
            <div>
              <div style="font-weight:700">Brat Generator Lab</div>
              <div class="muted tiny">Animated text art â€” fonts, colors, glow & export</div>
            </div>
            <div class="muted tiny">Click to open</div>
          </div>

          <!-- animated decorative layer -->
          <div class="brat-animated" id="brat-anim">
            <!-- subtle animated glow circles -->
            <svg width="320" height="120" viewBox="0 0 320 120" fill="none" aria-hidden>
              <defs>
                <linearGradient id="g1" x1="0" x2="1">
                  <stop offset="0" stop-color="rgba(255,255,255,0.06)"/>
                  <stop offset="1" stop-color="transparent"/>
                </linearGradient>
              </defs>
              <rect x="0" y="10" width="320" height="100" rx="12" fill="url(#g1)"></rect>
            </svg>
          </div>

          <!-- editor (hidden until open) -->
          <div id="brat-editor" style="display:none; padding:14px;">
            <div class="brat-editor">
              <!-- left: live preview -->
              <div>
                <div class="label">Live Preview</div>
                <div class="preview" id="brat-preview">
                  <div id="previewLayer" style="pointer-events:none; display:flex; align-items:center; justify-content:center; text-align:center; padding:20px;">
                    <canvas id="bratCanvas" width="800" height="360"></canvas>
                  </div>
                </div>

                <div style="display:flex; gap:8px; margin-top:8px; align-items:center">
                  <button class="small-btn" id="brat-random">Random</button>
                  <button class="small-btn" id="brat-download">Export PNG</button>
                  <div class="muted tiny" style="margin-left:auto">Watermark: Fluxo âœ¦ Abhiii</div>
                </div>
              </div>

              <!-- right: controls -->
              <div class="brat-controls">
                <div>
                  <div class="label">Text</div>
                  <input type="text" id="bratText" placeholder="Type your brat line â€” e.g., 'itâ€™s giving main character vibes ðŸ’…'">
                </div>

                <div>
                  <div class="label">Font</div>
                  <select id="bratFont">
                    <option value="48px Inter">Inter (clean)</option>
                    <option value="56px Playfair Display">Playfair (elegant)</option>
                    <option value="54px 'Montserrat'">Montserrat (bold)</option>
                    <option value="48px 'Courier New'">Mono (retro)</option>
                    <option value="56px 'Segoe UI'">Segoe UI</option>
                  </select>
                </div>

                <div>
                  <div class="label">Color</div>
                  <div class="swatches" id="bratColors">
                    <div class="swatch" style="background:linear-gradient(90deg,#ff7ab6,#ffb3d9)" data-color="#ffe6f0"></div>
                    <div class="swatch" style="background:linear-gradient(90deg,#60a5fa,#a78bfa)" data-color="#e6f0ff"></div>
                    <div class="swatch" style="background:linear-gradient(90deg,#34d399,#60a5fa)" data-color="#eafaf1"></div>
                    <div class="swatch" style="background:linear-gradient(90deg,#ffd166,#ff9f1c)" data-color="#fff3e0"></div>
                    <div class="swatch" style="background:linear-gradient(90deg,#0f172a,#1e293b)" data-color="#e6eef8"></div>
                  </div>
                </div>

                <div>
                  <div class="label">Background</div>
                  <div class="swatches">
                    <div class="swatch" style="background:linear-gradient(90deg,#fff3f8,#ffe6f0)" data-bg="linear-gradient(90deg,#fff3f8,#ffe6f0)"></div>
                    <div class="swatch" style="background:linear-gradient(90deg,#e6f0ff,#eff6ff)" data-bg="linear-gradient(90deg,#e6f0ff,#eff6ff)"></div>
                    <div class="swatch" style="background:linear-gradient(90deg,#f1f5f9,#e2e8f0)" data-bg="linear-gradient(90deg,#f1f5f9,#e2e8f0)"></div>
                    <div class="swatch" style="background:linear-gradient(90deg,#161616,#0b0b0b)" data-bg="linear-gradient(90deg,#161616,#0b0b0b)"></div>
                  </div>
                </div>

                <div>
                  <div class="label">Effects</div>
                  <div class="toggle">
                    <label><input type="checkbox" id="bratGlow"> Glow</label>
                    <label><input type="checkbox" id="bratOutline"> Outline</label>
                    <label><input type="checkbox" id="bratShadow"> Shadow</label>
                  </div>
                </div>

                <div style="margin-top:auto">
                  <div class="label">Size / Align</div>
                  <div style="display:flex; gap:8px">
                    <input id="bratSize" type="range" min="28" max="120" value="56" />
                    <select id="bratAlign">
                      <option value="center">Center</option>
                      <option value="left">Left</option>
                      <option value="right">Right</option>
                    </select>
                  </div>
                </div>

              </div>
            </div>
          </div>

        </div>
      </div>

      <!-- extra informational card -->
      <div class="card" style="margin-top:14px">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div style="font-weight:700">Fluxo Labs</div>
            <div class="muted tiny">Pro features, local export, responsive UI â€” no backend required</div>
          </div>
          <div class="muted tiny">Version v3.5</div>
        </div>
      </div>
    </div>

    <!-- RIGHT: Studio -->
    <aside class="card studio">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div style="font-weight:700">Meme / Edit Studio</div>
        <div class="muted tiny">Upload â†’ Edit â†’ Export</div>
      </div>

      <div style="height:12px"></div>

      <div class="canvas-wrap" id="studioCanvasWrap">
        <div id="studioArea" style="width:100%; height:100%; position:relative; display:flex; align-items:center; justify-content:center; overflow:hidden; background:linear-gradient(180deg, rgba(0,0,0,0.12), rgba(0,0,0,0.02))">
          <canvas id="studioCanvas" width="800" height="360" style="max-width:100%; border-radius:12px;"></canvas>
        </div>
      </div>

      <div style="margin-top:12px; display:flex; gap:8px; align-items:center; justify-content:space-between">
        <label class="upload-btn" for="fileInput">Upload Image</label>
        <input type="file" id="fileInput" accept="image/*">
        <div style="display:flex; gap:8px">
          <button class="small-btn" id="addTextBtn">Add Text</button>
          <button class="small-btn" id="exportStudio">Export</button>
        </div>
      </div>

      <div class="layers" id="layers"></div>

      <div style="margin-top:12px">
        <div class="label">Filters</div>
        <div class="filter-row">
          <label class="tiny muted">Brightness <input type="range" id="fBrightness" min="50" max="150" value="100"></label>
          <label class="tiny muted">Contrast <input type="range" id="fContrast" min="50" max="150" value="100"></label>
          <label class="tiny muted">Saturation <input type="range" id="fSaturate" min="0" max="200" value="100"></label>
          <label class="tiny muted">Blur <input type="range" id="fBlur" min="0" max="6" value="0"></label>
        </div>
      </div>

    </aside>

  </main>

  <footer class="sitefoot">crafted with ðŸ’– by Abhiii for the meme geeks</footer>
</div>

<script>
/* ==========================
   Background particles (optimized)
   ========================== */
const bg = document.getElementById('bg');
const bgCtx = bg.getContext('2d');
let DPR = Math.max(1, window.devicePixelRatio || 1);
function resizeBg(){
  DPR = Math.max(1, window.devicePixelRatio || 1);
  bg.width = innerWidth * DPR; bg.height = innerHeight * DPR;
  bg.style.width = innerWidth + 'px'; bg.style.height = innerHeight + 'px';
  bgCtx.setTransform(DPR,0,0,DPR,0,0);
}
window.addEventListener('resize', resizeBg);
resizeBg();
const PCOUNT = Math.max(40, Math.floor((innerWidth*innerHeight)/120000));
const PARTS = [];
for(let i=0;i<PCOUNT;i++){
  PARTS.push({x:Math.random()*innerWidth, y:Math.random()*innerHeight, r:1+Math.random()*2.6, vx:(Math.random()-0.5)*0.3, vy:(Math.random()-0.5)*0.3, hue:200+Math.random()*140});
}
let mouse = {x:innerWidth/2, y:innerHeight/2};
window.addEventListener('mousemove', e => { mouse.x = e.clientX; mouse.y = e.clientY; });
function drawBg(){
  bgCtx.clearRect(0,0,innerWidth,innerHeight);
  // gradient overlay
  const g = bgCtx.createLinearGradient(0,0,innerWidth,innerHeight);
  g.addColorStop(0, 'rgba(6,12,24,0.12)'); g.addColorStop(1,'rgba(12,30,46,0.18)');
  bgCtx.fillStyle = g; bgCtx.fillRect(0,0,innerWidth,innerHeight);

  for(let p of PARTS){
    p.x += p.vx + (mouse.x - p.x) * 0.0006;
    p.y += p.vy + (mouse.y - p.y) * 0.0006;
    if(p.x < -50) p.x = innerWidth + 50; if(p.x > innerWidth + 50) p.x = -50;
    if(p.y < -50) p.y = innerHeight + 50; if(p.y > innerHeight + 50) p.y = -50;

    const gr = bgCtx.createRadialGradient(p.x,p.y,0,p.x,p.y,p.r*12);
    gr.addColorStop(0, 'rgba(167,139,250,0.12)'); gr.addColorStop(1, 'rgba(96,165,250,0.01)');
    bgCtx.fillStyle = gr;
    bgCtx.beginPath(); bgCtx.arc(p.x,p.y,p.r,0,Math.PI*2); bgCtx.fill();
  }

  // light connections
  for(let i=0;i<PARTS.length;i++){
    for(let j=i+1;j<PARTS.length;j++){
      const a=PARTS[i], b=PARTS[j]; const dx=a.x-b.x, dy=a.y-b.y; const d=Math.sqrt(dx*dx+dy*dy);
      if(d<120){
        bgCtx.beginPath();
        bgCtx.strokeStyle = `rgba(100,140,200,${(120-d)/220})`; bgCtx.lineWidth=0.6;
        bgCtx.moveTo(a.x,a.y); bgCtx.lineTo(b.x,b.y); bgCtx.stroke();
      }
    }
  }

  requestAnimationFrame(drawBg);
}
requestAnimationFrame(drawBg);


/* ==========================
   Theme selector
   ========================== */
document.querySelectorAll('.theme-dot').forEach(el=>{
  el.addEventListener('click', ()=> {
    const theme = el.dataset.theme;
    document.body.className = theme;
  });
});

/* ==========================
   Brat lab logic (canvas text rendering + export)
   ========================== */
const bratOpenBtn = document.getElementById('brat-opening');
const bratEditor = document.getElementById('brat-editor');
const bratAnim = document.getElementById('brat-anim');
const bratCanvas = document.getElementById('bratCanvas');
const bCtx = bratCanvas.getContext('2d');
const bratText = document.getElementById('bratText');
const bratFont = document.getElementById('bratFont');
const bratColors = document.getElementById('bratColors');
const bratBGSwatches = document.querySelectorAll('#brat-editor .swatch[data-bg], #brat-editor .swatch[data-bg]');
const bratSize = document.getElementById('bratSize');
const bratAlign = document.getElementById('bratAlign');
const bratGlow = document.getElementById('bratGlow');
const bratOutline = document.getElementById('bratOutline');
const bratShadow = document.getElementById('bratShadow');
const bratDownload = document.getElementById('brat-download');
const bratRandom = document.getElementById('brat-random');

let bratConfig = {
  text: "itâ€™s giving main character vibes ðŸ’…",
  font: bratFont.value,
  color: "#ffe6f0",
  bg: "linear-gradient(90deg,#fff3f8,#ffe6f0)",
  size: Number(bratSize.value),
  align: 'center',
  glow:false, outline:false, shadow:false
};

function openBrat(){
  bratAnim.classList.add('show');
  bratEditor.style.display='block';
  setTimeout(()=> { bratAnim.style.pointerEvents='none'; }, 600);
  renderBrat();
}
bratOpenBtn.addEventListener('click', ()=> { if(bratEditor.style.display=='block'){ bratEditor.style.display='none'; bratAnim.classList.remove('show'); } else openBrat();});
document.getElementById('open-brat').addEventListener('click', openBrat);

// swatch clicks
document.querySelectorAll('#bratColors .swatch').forEach(s=>{
  s.addEventListener('click', ()=> { bratConfig.color = s.dataset.color; renderBrat(); });
});
document.querySelectorAll('#brat-editor .swatch[data-bg]').forEach(s=>{
  s.addEventListener('click', ()=> { bratConfig.bg = s.dataset.bg; renderBrat(); });
});
bratFont.addEventListener('change', ()=> { bratConfig.font = bratFont.value; renderBrat(); });
bratText.addEventListener('input', ()=> { bratConfig.text = bratText.value; renderBrat(); });
bratSize.addEventListener('input', ()=> { bratConfig.size = Number(bratSize.value); renderBrat(); });
bratAlign.addEventListener('change', ()=> { bratConfig.align = bratAlign.value; renderBrat(); });
[bratGlow, bratOutline, bratShadow].forEach(ch=>{
  ch.addEventListener('change', ()=> { bratConfig.glow = bratGlow.checked; bratConfig.outline = bratOutline.checked; bratConfig.shadow = bratShadow.checked; renderBrat(); });
});

function clearBratCanvas(){
  bCtx.clearRect(0,0,bratCanvas.width, bratCanvas.height);
}
function renderBrat(){
  // draw background
  bCtx.save();
  // create gradient fill from CSS-like minibg
  const tmp = bratConfig.bg;
  // simple fallback: use solid color derived from gradient (first color)
  let bgColor = "#111";
  const m = tmp.match(/#([0-9a-fA-F]{3,6})/);
  if(m) { bgColor = m[0]; }
  bCtx.fillStyle = bgColor;
  bCtx.fillRect(0,0,bratCanvas.width, bratCanvas.height);

  // text
  const fontSpec = bratConfig.font;
  const sizePx = bratConfig.size;
  bCtx.font = `${sizePx}px ${fontSpec.split(' ').slice(1).join(' ') || 'Inter'}`;
  bCtx.textBaseline = "middle";
  bCtx.textAlign = bratConfig.align;
  const x = bratConfig.align === 'left' ? 30 : (bratConfig.align === 'right' ? bratCanvas.width - 30 : bratCanvas.width/2);
  const y = bratCanvas.height/2;

  // shadow
  if(bratConfig.shadow){
    bCtx.shadowColor = 'rgba(0,0,0,0.45)'; bCtx.shadowBlur = 18; bCtx.shadowOffsetY = 6;
  } else { bCtx.shadowColor = 'transparent'; bCtx.shadowBlur = 0; bCtx.shadowOffsetY = 0; }

  // outline
  if(bratConfig.outline){
    bCtx.lineWidth = Math.max(2, sizePx * 0.06);
    bCtx.strokeStyle = '#000000aa';
    bCtx.strokeText(bratConfig.text, x, y);
  }

  // glow (draw multiple blurred layers)
  if(bratConfig.glow){
    for(let i=6;i>=1;i--){
      bCtx.globalAlpha = 0.06;
      bCtx.fillStyle = bratConfig.color;
      bCtx.filter = `blur(${i}px)`;
      bCtx.fillText(bratConfig.text, x, y);
    }
    bCtx.filter = 'none';
    bCtx.globalAlpha = 1;
  }

  // main fill
  bCtx.fillStyle = bratConfig.color;
  bCtx.fillText(bratConfig.text, x, y);

  // watermark
  bCtx.font = '12px Inter';
  bCtx.fillStyle = 'rgba(255,255,255,0.18)';
  bCtx.textAlign = 'right';
  bCtx.fillText('Fluxo âœ¦ Abhiii', bratCanvas.width - 12, bratCanvas.height - 12);

  bCtx.restore();
}

// randomize
bratRandom.addEventListener('click', ()=> {
  const pool = [
    "itâ€™s giving main character vibes ðŸ’…",
    "i woke up iconic âœ¨",
    "sorry not sorry â€” vibe secured",
    "mood: designer energy ðŸ’«",
    "too glam to give a damn ðŸ’–"
  ];
  bratText.value = pool[Math.floor(Math.random()*pool.length)];
  bratSize.value = 56 + Math.floor(Math.random()*20);
  bratConfig.text = bratText.value; bratConfig.size = Number(bratSize.value);
  renderBrat();
});

// export
bratDownload.addEventListener('click', ()=> {
  const el = bratCanvas;
  html2canvas(el, {backgroundColor: null, scale: 2}).then(canvas => {
    const a = document.createElement('a');
    a.download = 'fluxo-brat.png';
    a.href = canvas.toDataURL('image/png');
    a.click();
  });
});

renderBrat();

/* ==========================
   Studio area (canvas image + layers)
   - local image draw, add text layers, draggable
   ========================== */
const studioCanvas = document.getElementById('studioCanvas');
const sCtx = studioCanvas.getContext('2d');
const fileInput = document.getElementById('fileInput');
const addTextBtn = document.getElementById('addTextBtn');
const layersEl = document.getElementById('layers');
const exportStudio = document.getElementById('exportStudio');

let studioState = { bgImage: null, layers: [], filters:{b:100,c:100,s:100, blur:0} };

function drawStudio(){
  // clear
  sCtx.clearRect(0,0,studioCanvas.width, studioCanvas.height);
  // filter background fill
  sCtx.fillStyle = 'rgba(10,12,16,0.1)';
  sCtx.fillRect(0,0,studioCanvas.width, studioCanvas.height);

  // draw background image if present (fit-cover)
  if(studioState.bgImage){
    const img = studioState.bgImage;
    // cover fit
    const sw = img.width, sh = img.height;
    const cw = studioCanvas.width, ch = studioCanvas.height;
    const scale = Math.max(cw/sw, ch/sh);
    const dw = sw*scale, dh = sh*scale;
    const dx = (cw - dw)/2, dy = (ch - dh)/2;
    sCtx.save();
    // apply CSS-like filters
    sCtx.filter = `brightness(${studioState.filters.b/100}) contrast(${studioState.filters.c/100}) saturate(${studioState.filters.s/100}) blur(${studioState.filters.blur}px)`;
    sCtx.drawImage(img, dx, dy, dw, dh);
    sCtx.restore();
  } else {
    // soft pattern
    sCtx.fillStyle = '#08121a'; sCtx.fillRect(0,0,studioCanvas.width, studioCanvas.height);
  }

  // draw text layers
  for(const layer of studioState.layers){
    sCtx.save();
    sCtx.translate(layer.x, layer.y);
    sCtx.rotate(layer.rot || 0);
    sCtx.font = `${layer.size}px ${layer.font || 'Inter'}`;
    sCtx.textAlign = layer.align || 'center';
    // shadow
    sCtx.shadowColor = 'rgba(0,0,0,0.45)'; sCtx.shadowBlur = 8; sCtx.shadowOffsetY = 3;
    sCtx.fillStyle = layer.color || '#fff';
    sCtx.fillText(layer.text, 0, 0);
    sCtx.restore();
  }
}

// file upload
fileInput.addEventListener('change', (e)=>{
  const f = e.target.files && e.target.files[0];
  if(!f) return;
  const img = new Image();
  img.onload = ()=> { studioState.bgImage = img; drawStudio(); }
  img.src = URL.createObjectURL(f);
});

// add text layer
addTextBtn.addEventListener('click', ()=>{
  const newLayer = { id: Date.now(), text:'New Text', x: studioCanvas.width/2, y: studioCanvas.height/2, size:36, color:'#ffffff', font:'Inter', align:'center' };
  studioState.layers.push(newLayer);
  renderLayersUI();
  drawStudio();
});

// layers UI
function renderLayersUI(){
  layersEl.innerHTML = '';
  studioState.layers.forEach(layer=>{
    const div = document.createElement('div'); div.className='layer';
    div.innerHTML = `<div style="flex:1"><input data-id="${layer.id}" class="layer-input" value="${layer.text}" style="background:transparent;border:none;color:var(--text);width:100%"></div>
      <div style="display:flex;gap:6px;align-items:center">
        <button class="small-btn layer-up" data-id="${layer.id}">â†‘</button>
        <button class="small-btn layer-del" data-id="${layer.id}">ðŸ—‘</button>
      </div>`;
    layersEl.appendChild(div);
  });

  // wiring
  document.querySelectorAll('.layer-input').forEach(inp=>{
    inp.addEventListener('input', e=>{
      const id = Number(inp.dataset.id);
      const l = studioState.layers.find(x=>x.id===id);
      if(l){ l.text = inp.value; drawStudio(); }
    });
  });
  document.querySelectorAll('.layer-del').forEach(b=>{
    b.addEventListener('click', ()=> {
      const id = Number(b.dataset.id); studioState.layers = studioState.layers.filter(x=>x.id!==id); renderLayersUI(); drawStudio();
    });
  });
  document.querySelectorAll('.layer-up').forEach(b=>{
    b.addEventListener('click', ()=> {
      const id = Number(b.dataset.id); const idx = studioState.layers.findIndex(x=>x.id===id);
      if(idx>0){ const a=studioState.layers[idx]; studioState.layers[idx]=studioState.layers[idx-1]; studioState.layers[idx-1]=a; renderLayersUI(); drawStudio(); }
    });
  });
}

// drag text layers (simple): click canvas to select nearest layer, then drag
let drag = { active:false, id:null, ox:0, oy:0 };
studioCanvas.addEventListener('mousedown', (e)=>{
  const rect = studioCanvas.getBoundingClientRect(); const mx = (e.clientX-rect.left); const my = (e.clientY-rect.top);
  // find nearest layer within threshold
  let nearest = null; let minD = 9999;
  for(const l of studioState.layers){
    const dx = mx - l.x, dy = my - l.y; const d = Math.sqrt(dx*dx+dy*dy);
    if(d < minD){ minD = d; nearest = l; }
  }
  if(nearest && minD < 80){ drag.active=true; drag.id = nearest.id; drag.ox = mx - nearest.x; drag.oy = my - nearest.y; }
});
window.addEventListener('mousemove', (e)=>{
  if(!drag.active) return;
  const rect = studioCanvas.getBoundingClientRect(); const mx = (e.clientX-rect.left); const my = (e.clientY-rect.top);
  const l = studioState.layers.find(x=>x.id===drag.id); if(l){ l.x = mx - drag.ox; l.y = my - drag.oy; drawStudio(); renderLayersUI(); }
});
window.addEventListener('mouseup', ()=> { drag.active=false; drag.id=null; });


// filters wiring
document.getElementById('fBrightness').addEventListener('input', e=>{ studioState.filters.b = Number(e.target.value); drawStudio(); });
document.getElementById('fContrast').addEventListener('input', e=>{ studioState.filters.c = Number(e.target.value); drawStudio(); });
document.getElementById('fSaturate').addEventListener('input', e=>{ studioState.filters.s = Number(e.target.value); drawStudio(); });
document.getElementById('fBlur').addEventListener('input', e=>{ studioState.filters.blur = Number(e.target.value); drawStudio(); });

// export studio area as PNG using canvas.toDataURL
exportStudio.addEventListener('click', ()=>{
  const url = studioCanvas.toDataURL('image/png');
  const a = document.createElement('a'); a.href = url; a.download = 'fluxo-edit.png'; a.click();
});

// basic autosave to localStorage
setInterval(()=> {
  try { localStorage.setItem('fluxo_state', JSON.stringify(studioState)); } catch(e){}
}, 5000);

// init UI
renderLayersUI();
drawStudio();

/* Keyboard shortcuts */
window.addEventListener('keydown', (e)=>{
  if(e.key === 'Delete' || e.key === 'Backspace'){ // remove last layer
    studioState.layers.pop(); renderLayersUI(); drawStudio();
  }
  if((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 's'){ // quick export
    e.preventDefault(); exportStudio.click();
  }
});

/* Auto small demo on first visit (fill sample brat text) */
if(!localStorage.getItem('fluxo_demo_shown')) {
  localStorage.setItem('fluxo_demo_shown','1');
  setTimeout(()=>{ openBrat(); bratText.value = "itâ€™s giving main character vibes ðŸ’…"; bratConfig.text = bratText.value; renderBrat(); }, 700);
}
</script>
</body>
</html>
