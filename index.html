<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fluxo â€” Make Your Edits Flowww âœ¦ Abhiii</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&family=Montserrat:wght@400;700&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">

  <!-- html2canvas for export -->
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <style>
    :root{
      --bg-1:#071224; --bg-2:#0b2233;
      --accent:#60a5fa; --accent2:#a78bfa; --muted:#94a3b8;
      --glass: rgba(255,255,255,0.04);
      --card: rgba(255,255,255,0.03);
      --radius:14px;
      --text:#e6eef8;
      --accent-strong:#ff66b3;
    }
    .theme-pink { --accent:#ff7ab6; --accent2:#ffb3d9; --card: rgba(255,255,255,0.03); --bg-1:#120417; --bg-2:#2b0a22; }
    .theme-green{ --accent:#34d399; --accent2:#60a5fa; --bg-1:#051214; --bg-2:#051f14;}
    .theme-dark{ --accent:#60a5fa; --accent2:#a78bfa; --bg-1:#071224; --bg-2:#0b2233; }
    .theme-golden{ --accent:#f59e0b; --accent2:#f97316; --bg-1:#0f0b05; --bg-2:#2b1f0b; }

    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial;color:var(--text);background:linear-gradient(180deg,var(--bg-1),var(--bg-2));-webkit-font-smoothing:antialiased}
    a{color:inherit}
    canvas#bg { position:fixed; inset:0; z-index:0; display:block; filter: blur(6px) contrast(.9); opacity:.95; }
    .wrap{position:relative;z-index:2;min-height:100vh;display:flex;flex-direction:column;align-items:stretch;}
    header.hero{display:flex;align-items:center;justify-content:space-between;padding:28px 6vw 20px;gap:20px}
    .brand {font-family: "Playfair Display", serif; font-size:28px; background:linear-gradient(90deg,var(--accent),var(--accent2)); -webkit-background-clip:text; color:transparent; letter-spacing:0.6px}
    .tag {color:var(--muted); font-size:13px}
    .controls-top{display:flex;gap:12px;align-items:center}

    .main { max-width:1200px; margin:18px auto; width:94%; display:grid; grid-template-columns: 1fr 420px; gap:24px; align-items:start; padding-bottom:40px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:var(--radius); padding:18px; box-shadow: 0 12px 30px rgba(0,0,0,0.45); border:1px solid rgba(255,255,255,0.03);}

    .landing{display:flex;flex-direction:column;gap:12px}
    .lead { font-size:20px; color:#dff3ff }
    .sublead { color:var(--muted); font-size:13px }

    .entry-buttons { display:flex; gap:12px; margin-top:10px }
    .btn { background:linear-gradient(90deg,var(--accent),var(--accent2)); border:none; color:#041025; padding:10px 14px; border-radius:10px; font-weight:700; cursor:pointer; box-shadow:0 8px 20px rgba(0,0,0,0.45) }
    .ghost { background:transparent; border:1px solid rgba(255,255,255,0.06); color:var(--text); padding:9px 12px; border-radius:10px; cursor:pointer }

    .theme-select { display:flex; gap:8px; align-items:center }
    .theme-dot { width:28px; height:28px; border-radius:8px; cursor:pointer; border:2px solid rgba(0,0,0,0.15) }

    /* Brat */
    .brat-shell { margin-top:18px }
    .brat-panel { overflow:hidden; border-radius:12px; position:relative }
    .brat-opening { display:flex; align-items:center; justify-content:space-between; gap:12px; padding:16px; cursor:pointer; transition:transform .28s; border-radius:12px; background:linear-gradient(90deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01)); }
    .brat-opening:hover { transform:translateY(-4px) }
    .brat-animated { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; pointer-events:none; opacity:0; transform:scale(.98); transition:all .45s ease }
    .brat-animated.show { opacity:1; transform:scale(1) }

    .brat-editor { display:grid; grid-template-columns: 1fr 380px; gap:14px; align-items:start; margin-top:12px }
    .preview { background:linear-gradient(180deg,rgba(0,0,0,0.18),transparent); border-radius:12px; height:360px; display:flex; align-items:center; justify-content:center; position:relative; overflow:hidden; }
    .preview canvas, .preview .previewLayer { width:100%; height:100%; display:block }
    .brat-controls { display:flex; flex-direction:column; gap:10px }
    .label{ font-size:13px; color:var(--muted); margin-bottom:6px;}
    input[type="text"], select { width:100%; padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,0.04); background:rgba(255,255,255,0.01); color:var(--text) }

    .swatches { display:flex; gap:8px; flex-wrap:wrap }
    .swatch { width:36px; height:36px; border-radius:8px; cursor:pointer; border:2px solid rgba(255,255,255,0.03) }

    .toggle { display:flex; gap:8px; align-items:center }
    .small-btn { padding:8px 10px; border-radius:8px; background:rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.03); cursor:pointer }

    .export-row { display:flex; gap:8px; margin-top:10px; align-items:center }

    /* Studio */
    .studio { position:sticky; top:24px }
    .studio .canvas-wrap { height:360px; border-radius:12px; overflow:hidden; display:flex; align-items:center; justify-content:center; background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.00)); border:1px solid rgba(255,255,255,0.02) }
    .studio input[type=file]{ display:none }
    .studio .upload-btn { display:inline-flex; gap:8px; padding:10px 12px; border-radius:10px; background:linear-gradient(90deg,var(--accent),var(--accent2)); color:#041025; font-weight:700; cursor:pointer; }

    .layers { margin-top:12px; display:flex; flex-direction:column; gap:8px; max-height:200px; overflow:auto }
    .layer { display:flex; gap:8px; align-items:center; justify-content:space-between; padding:8px; background:rgba(255,255,255,0.02); border-radius:8px; border:1px solid rgba(255,255,255,0.02) }
    .filter-row { display:flex; gap:10px; margin-top:10px; align-items:center; flex-wrap:wrap }

    footer.sitefoot { text-align:center; padding:22px 10px; color:var(--muted); border-top:1px solid rgba(255,255,255,0.02); margin-top:24px }

    @media(max-width:980px){
      .main { grid-template-columns:1fr; }
      .brat-editor { grid-template-columns: 1fr; }
      .studio { position:relative; top:auto }
    }

    .muted{ color:var(--muted); font-size:13px }
    .tiny{ font-size:12px }

    /* Nice UI touches */
    .glow-pill { padding:10px 14px; border-radius:999px; background:linear-gradient(90deg,var(--accent),var(--accent2)); color:#041025; font-weight:700; box-shadow:0 12px 40px rgba(100,120,255,0.12) }
    .hide-for-export { transition:opacity .2s ease }
  </style>
</head>
<body class="theme-dark">

<!-- background canvas -->
<canvas id="bg"></canvas>

<div class="wrap">
  <header class="hero">
    <div>
      <div class="brand">Fluxo <span style="font-weight:400; font-size:12px; color:var(--muted)">âœ¦ make your edits flowww</span></div>
      <div class="tag muted">Crafted with ðŸ’– by Abhiii â€” for the meme geeks</div>
    </div>

    <div class="controls-top">
      <div class="theme-select">
        <div class="muted tiny" style="margin-right:8px">Themes</div>
        <div class="theme-dot" title="Pink" style="background:linear-gradient(90deg,#ff7ab6,#ffb3d9)" data-theme="theme-pink"></div>
        <div class="theme-dot" title="Green" style="background:linear-gradient(90deg,#34d399,#60a5fa)" data-theme="theme-green"></div>
        <div class="theme-dot" title="Dark" style="background:linear-gradient(90deg,#60a5fa,#a78bfa)" data-theme="theme-dark"></div>
        <div class="theme-dot" title="Golden" style="background:linear-gradient(90deg,#f59e0b,#f97316)" data-theme="theme-golden"></div>
      </div>
      <button class="ghost" id="open-brat">Open Brat Lab</button>
      <button class="btn" id="goto-studio">Open Edit Studio</button>
    </div>
  </header>

  <main class="main">
    <!-- LEFT -->
    <div>
      <div class="card landing">
        <div class="lead">Fluxo â€” Brat Lab & Meme Studio</div>
        <div class="sublead">Create trendy brat text art and powerful meme edits â€” professional UI, local export, responsive.</div>
        <div class="entry-buttons">
          <div class="glow-pill hide-for-export">Fluxo v4.0 â€¢ Local Export</div>
        </div>
      </div>

      <!-- BRAT Shell -->
      <div class="card brat-shell" id="brat-shell">
        <div class="brat-panel">
          <div class="brat-opening" id="brat-opening">
            <div>
              <div style="font-weight:700">Brat Generator Lab</div>
              <div class="muted tiny">Animated text art â€” fonts, colors, glow & export</div>
            </div>
            <div class="muted tiny">Click to open</div>
          </div>

          <div class="brat-animated" id="brat-anim">
            <!-- decorative -->
            <svg width="320" height="120" viewBox="0 0 320 120" fill="none" aria-hidden>
              <defs>
                <linearGradient id="g1" x1="0" x2="1">
                  <stop offset="0" stop-color="rgba(255,255,255,0.06)"/>
                  <stop offset="1" stop-color="transparent"/>
                </linearGradient>
              </defs>
              <rect x="0" y="10" width="320" height="100" rx="12" fill="url(#g1)"></rect>
            </svg>
          </div>

          <!-- editor -->
          <div id="brat-editor" style="display:none; padding:14px;">
            <div class="brat-editor">
              <!-- preview -->
              <div>
                <div class="label">Live Preview</div>
                <div class="preview" id="brat-preview">
                  <div style="pointer-events:none; display:flex; align-items:center; justify-content:center; text-align:center; padding:20px; width:100%; height:100%">
                    <canvas id="bratCanvas" width="900" height="420" style="max-width:100%; border-radius:12px;"></canvas>
                  </div>
                </div>

                <div style="display:flex; gap:8px; margin-top:8px; align-items:center">
                  <button class="small-btn" id="brat-random">Random</button>
                  <button class="small-btn" id="brat-download">Export PNG</button>
                  <div class="muted tiny" style="margin-left:auto">Watermark: Fluxo âœ¦ Abhiii</div>
                </div>
              </div>

              <!-- controls -->
              <div class="brat-controls">
                <div>
                  <div class="label">Text</div>
                  <input type="text" id="bratText" placeholder="Type your brat line â€” e.g., 'itâ€™s giving main character vibes ðŸ’…'">
                </div>

                <div>
                  <div class="label">Font</div>
                  <select id="bratFont">
                    <option value="48px Inter">Inter (clean)</option>
                    <option value="56px Playfair Display">Playfair (elegant)</option>
                    <option value="54px Montserrat">Montserrat (bold)</option>
                    <option value="48px 'Courier New'">Mono (retro)</option>
                    <option value="56px 'Segoe UI'">Segoe UI</option>
                  </select>
                </div>

                <div>
                  <div class="label">Text Color</div>
                  <div class="swatches" id="bratColors">
                    <div class="swatch" style="background:linear-gradient(90deg,#ff7ab6,#ffb3d9)" data-color="#2b0a12" title="Pink"></div>
                    <div class="swatch" style="background:linear-gradient(90deg,#60a5fa,#a78bfa)" data-color="#041025" title="Blue"></div>
                    <div class="swatch" style="background:linear-gradient(90deg,#34d399,#60a5fa)" data-color="#003428" title="Green"></div>
                    <div class="swatch" style="background:linear-gradient(90deg,#ffd166,#ff9f1c)" data-color="#2b1500" title="Gold"></div>
                    <div class="swatch" style="background:linear-gradient(90deg,#0f172a,#1e293b)" data-color="#e6eef8" title="White"></div>
                  </div>
                </div>

                <div>
                  <div class="label">Background</div>
                  <div class="swatches" id="bratBGs">
                    <div class="swatch" style="background:linear-gradient(90deg,#fff3f8,#ffe6f0)" data-bg="linear-gradient(90deg,#fff3f8,#ffe6f0)"></div>
                    <div class="swatch" style="background:linear-gradient(90deg,#e6f0ff,#eff6ff)" data-bg="linear-gradient(90deg,#e6f0ff,#eff6ff)"></div>
                    <div class="swatch" style="background:linear-gradient(90deg,#f1f5f9,#e2e8f0)" data-bg="linear-gradient(90deg,#f1f5f9,#e2e8f0)"></div>
                    <div class="swatch" style="background:linear-gradient(90deg,#161616,#0b0b0b)" data-bg="linear-gradient(90deg,#161616,#0b0b0b)"></div>
                    <div class="swatch" style="background:linear-gradient(90deg,#ffdede,#ffd8e0)" data-bg="linear-gradient(90deg,#ffdede,#ffd8e0)"></div>
                  </div>
                </div>

                <div>
                  <div class="label">Effects</div>
                  <div class="toggle">
                    <label><input type="checkbox" id="bratGlow"> Glow</label>
                    <label><input type="checkbox" id="bratOutline"> Outline</label>
                    <label><input type="checkbox" id="bratShadow"> Shadow</label>
                  </div>
                </div>

                <div style="margin-top:auto">
                  <div class="label">Size / Align</div>
                  <div style="display:flex; gap:8px; align-items:center">
                    <input id="bratSize" type="range" min="28" max="120" value="56" />
                    <select id="bratAlign">
                      <option value="center">Center</option>
                      <option value="left">Left</option>
                      <option value="right">Right</option>
                    </select>
                  </div>
                </div>

              </div>
            </div>
          </div>

        </div>
      </div>

      <div class="card" style="margin-top:14px">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div style="font-weight:700">Fluxo Labs</div>
            <div class="muted tiny">Pro features, local export, responsive UI â€” no backend required</div>
          </div>
          <div class="muted tiny">Version v4.0</div>
        </div>
      </div>
    </div>

    <!-- RIGHT: Studio -->
    <aside class="card studio">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div style="font-weight:700">Meme / Edit Studio</div>
        <div class="muted tiny">Upload â†’ Edit â†’ Export</div>
      </div>

      <div style="height:12px"></div>

      <div class="canvas-wrap" id="studioCanvasWrap">
        <div id="studioArea" style="width:100%; height:100%; position:relative; display:flex; align-items:center; justify-content:center; overflow:hidden; background:linear-gradient(180deg, rgba(0,0,0,0.12), rgba(0,0,0,0.02))">
          <canvas id="studioCanvas" width="900" height="420" style="max-width:100%; border-radius:12px;"></canvas>
        </div>
      </div>

      <div style="margin-top:12px; display:flex; gap:8px; align-items:center; justify-content:space-between">
        <label class="upload-btn" for="fileInput">Upload Image</label>
        <input type="file" id="fileInput" accept="image/*">
        <div style="display:flex; gap:8px">
          <button class="small-btn" id="addTextBtn">Add Text</button>
          <button class="small-btn" id="exportStudio">Export</button>
        </div>
      </div>

      <div class="layers" id="layers"></div>

      <div style="margin-top:12px">
        <div class="label">Filters</div>
        <div class="filter-row">
          <label class="tiny muted">Brightness <input type="range" id="fBrightness" min="50" max="150" value="100"></label>
          <label class="tiny muted">Contrast <input type="range" id="fContrast" min="50" max="150" value="100"></label>
          <label class="tiny muted">Saturation <input type="range" id="fSaturate" min="0" max="200" value="100"></label>
          <label class="tiny muted">Blur <input type="range" id="fBlur" min="0" max="6" value="0"></label>
        </div>
      </div>

    </aside>

  </main>

  <footer class="sitefoot">Â© 2025 Crafted with ðŸ’– by Abhiii for the Meme Geeks</footer>
</div>

<script>
/* ==========================
   Background particle system
   ========================== */
const bg = document.getElementById('bg');
const bgCtx = bg.getContext('2d');
let DPR = Math.max(1, window.devicePixelRatio || 1);
function resizeBg(){
  DPR = Math.max(1, window.devicePixelRatio || 1);
  bg.width = innerWidth * DPR; bg.height = innerHeight * DPR;
  bg.style.width = innerWidth + 'px'; bg.style.height = innerHeight + 'px';
  bgCtx.setTransform(DPR,0,0,DPR,0,0);
}
window.addEventListener('resize', resizeBg);
resizeBg();
const PCOUNT = Math.max(40, Math.floor((innerWidth*innerHeight)/120000));
const PARTS = [];
for(let i=0;i<PCOUNT;i++){
  PARTS.push({x:Math.random()*innerWidth, y:Math.random()*innerHeight, r:1+Math.random()*2.6, vx:(Math.random()-0.5)*0.3, vy:(Math.random()-0.5)*0.3, hue:200+Math.random()*140});
}
let mouse = {x:innerWidth/2, y:innerHeight/2};
window.addEventListener('mousemove', e => { mouse.x = e.clientX; mouse.y = e.clientY; });
function drawBg(){
  bgCtx.clearRect(0,0,innerWidth,innerHeight);
  const g = bgCtx.createLinearGradient(0,0,innerWidth,innerHeight);
  g.addColorStop(0, 'rgba(6,12,24,0.12)'); g.addColorStop(1,'rgba(12,30,46,0.18)');
  bgCtx.fillStyle = g; bgCtx.fillRect(0,0,innerWidth,innerHeight);
  for(let p of PARTS){
    p.x += p.vx + (mouse.x - p.x) * 0.0006;
    p.y += p.vy + (mouse.y - p.y) * 0.0006;
    if(p.x < -50) p.x = innerWidth + 50; if(p.x > innerWidth + 50) p.x = -50;
    if(p.y < -50) p.y = innerHeight + 50; if(p.y > innerHeight + 50) p.y = -50;
    const gr = bgCtx.createRadialGradient(p.x,p.y,0,p.x,p.y,p.r*12);
    gr.addColorStop(0, 'rgba(167,139,250,0.12)'); gr.addColorStop(1, 'rgba(96,165,250,0.01)');
    bgCtx.fillStyle = gr;
    bgCtx.beginPath(); bgCtx.arc(p.x,p.y,p.r,0,Math.PI*2); bgCtx.fill();
  }
  for(let i=0;i<PARTS.length;i++){
    for(let j=i+1;j<PARTS.length;j++){
      const a=PARTS[i], b=PARTS[j]; const dx=a.x-b.x, dy=a.y-b.y; const d=Math.sqrt(dx*dx+dy*dy);
      if(d<120){
        bgCtx.beginPath();
        bgCtx.strokeStyle = `rgba(100,140,200,${(120-d)/220})`; bgCtx.lineWidth=0.6;
        bgCtx.moveTo(a.x,a.y); bgCtx.lineTo(b.x,b.y); bgCtx.stroke();
      }
    }
  }
  requestAnimationFrame(drawBg);
}
requestAnimationFrame(drawBg);

/* ==========================
   Theme picker
   ========================== */
document.querySelectorAll('.theme-dot').forEach(el=>{
  el.addEventListener('click', ()=> {
    const theme = el.dataset.theme;
    document.body.className = theme;
  });
});

/* ==========================
   Brat lab logic (canvas text rendering + export)
   ========================== */
const bratOpenBtn = document.getElementById('brat-opening');
const bratEditor = document.getElementById('brat-editor');
const bratAnim = document.getElementById('brat-anim');
const bratCanvas = document.getElementById('bratCanvas');
const bCtx = bratCanvas.getContext('2d');
const bratText = document.getElementById('bratText');
const bratFont = document.getElementById('bratFont');
const bratColors = document.getElementById('bratColors');
const bratBGs = document.getElementById('bratBGs');
const bratSize = document.getElementById('bratSize');
const bratAlign = document.getElementById('bratAlign');
const bratGlow = document.getElementById('bratGlow');
const bratOutline = document.getElementById('bratOutline');
const bratShadow = document.getElementById('bratShadow');
const bratDownload = document.getElementById('brat-download');
const bratRandom = document.getElementById('brat-random');

let bratConfig = {
  text: "itâ€™s giving main character vibes ðŸ’…",
  font: bratFont.value,
  color: "#041025",
  bg: "linear-gradient(90deg,#fff3f8,#ffe6f0)",
  size: Number(bratSize.value),
  align: 'center',
  glow:false, outline:false, shadow:false
};

function openBrat(){
  bratEditor.style.display = 'block';
  bratAnim.classList.add('show');
  setTimeout(()=> bratAnim.style.pointerEvents = 'none', 600);
}
bratOpenBtn.addEventListener('click', ()=> {
  openBrat();
  // focus input
  setTimeout(()=> bratText.focus(), 220);
});

/* color / bg events */
bratColors.querySelectorAll('.swatch').forEach(s=>{
  s.addEventListener('click', ()=> {
    bratConfig.color = s.dataset.color || '#041025';
    renderBrat();
  });
});
bratBGs.querySelectorAll('.swatch').forEach(s=>{
  s.addEventListener('click', ()=> {
    bratConfig.bg = s.dataset.bg || 'linear-gradient(90deg,#fff3f8,#ffe6f0)';
    renderBrat();
  });
});

/* controls */
bratText.addEventListener('input', ()=> { bratConfig.text = bratText.value || bratConfig.text; renderBrat(); });
bratFont.addEventListener('change', ()=> { bratConfig.font = bratFont.value; renderBrat(); });
bratSize.addEventListener('input', ()=> { bratConfig.size = Number(bratSize.value); renderBrat(); });
bratAlign.addEventListener('change', ()=> { bratConfig.align = bratAlign.value; renderBrat(); });
bratGlow.addEventListener('change', ()=> { bratConfig.glow = bratGlow.checked; renderBrat(); });
bratOutline.addEventListener('change', ()=> { bratConfig.outline = bratOutline.checked; renderBrat(); });
bratShadow.addEventListener('change', ()=> { bratConfig.shadow = bratShadow.checked; renderBrat(); });

/* randomize */
bratRandom.addEventListener('click', ()=> {
  const samples = [
    "brat and it's dramatic energy ðŸ’…",
    "not sorry, just iconic âœ¨",
    "main character mood activated ðŸŽ¬",
    "i woke up like this â€” flawless",
    "sheesh, peak aesthetics ðŸ‘‘",
    "sorry not sorry, vibes only"
  ];
  bratConfig.text = samples[Math.floor(Math.random()*samples.length)];
  bratText.value = bratConfig.text;
  bratConfig.size = 36 + Math.floor(Math.random()*56);
  bratSize.value = bratConfig.size;
  bratConfig.glow = Math.random()>0.5;
  bratConfig.outline = Math.random()>0.4;
  bratConfig.shadow = Math.random()>0.6;
  renderBrat();
});

/* draw text wrapped on canvas */
function wrapText(ctx, text, x, y, maxWidth, lineHeight, align) {
  const words = text.split(' ');
  let line = '';
  const lines = [];
  for (let n = 0; n < words.length; n++) {
    const testLine = line + words[n] + ' ';
    const metrics = ctx.measureText(testLine);
    if (metrics.width > maxWidth && n > 0) {
      lines.push(line.trim());
      line = words[n] + ' ';
    } else {
      line = testLine;
    }
  }
  lines.push(line.trim());
  // return list
  return lines;
}

function renderBrat(){
  const cw = bratCanvas.width = Math.min(1400, Math.max(700, document.getElementById('brat-preview').clientWidth * 1));
  const ch = bratCanvas.height = 420;
  // background: draw gradient/solid from bratConfig.bg
  // simple parse for linear-gradient fallback: we'll draw a soft fill matching selected swatches via color extraction
  bCtx.clearRect(0,0,cw,ch);
  // attempt to parse if linear-gradient(...) else fallback color
  let bgFill = '#ffdede';
  if(bratConfig.bg.startsWith('linear-gradient')) {
    // pick sample color by scanning characters (simple hack)
    if(bratConfig.bg.includes('#fff3f8')) bgFill = '#fff3f8';
    else if(bratConfig.bg.includes('#e6f0ff')) bgFill = '#e6f0ff';
    else if(bratConfig.bg.includes('#161616')) bgFill = '#0b0b0b';
    else if(bratConfig.bg.includes('#ffdede')) bgFill = '#ffdede';
  } else bgFill = bratConfig.bg || '#fff3f8';
  // gradient fill
  const g = bCtx.createLinearGradient(0,0,cw,ch);
  g.addColorStop(0, shadeColor(bgFill, 0));
  g.addColorStop(1, shadeColor(bgFill, -6));
  bCtx.fillStyle = g;
  roundRect(bCtx, 0, 0, cw, ch, 16, true, false);

  // text styles
  const fontSize = bratConfig.size || 56;
  bCtx.textAlign = bratConfig.align === 'left' ? 'left' : (bratConfig.align === 'right' ? 'right' : 'center');
  const fontName = bratConfig.font.split(' ').slice(1).join(' ') || 'Inter';
  bCtx.font = `${fontSize}px ${fontName}`;
  const textColor = bratConfig.color || '#041025';
  const padding = 40;
  const maxWidth = cw - padding*2;
  const lines = wrapText(bCtx, bratConfig.text, padding, padding, maxWidth, fontSize * 1.05, bratConfig.align);
  // calculate start Y
  const totalHeight = lines.length * fontSize * 1.05;
  let startY = (ch - totalHeight)/2 + fontSize;

  // shadow/glow/outlines
  if(bratConfig.shadow){
    bCtx.save();
    bCtx.shadowColor = 'rgba(0,0,0,0.35)';
    bCtx.shadowBlur = 18;
    bCtx.shadowOffsetY = 6;
  }
  if(bratConfig.glow){
    bCtx.save();
    bCtx.shadowColor = hexToRgba(textColor, 0.45);
    bCtx.shadowBlur = Math.max(8, fontSize/3);
  }

  // draw each line
  for(let i=0;i<lines.length;i++){
    const line = lines[i];
    const x = bratConfig.align === 'left' ? padding : (bratConfig.align === 'right' ? cw-padding : cw/2);
    const y = startY + i * fontSize * 1.05;
    // outline
    if(bratConfig.outline){
      bCtx.lineWidth = Math.max(6, fontSize/12);
      bCtx.strokeStyle = '#ffffff';
      bCtx.strokeText(line, x, y);
    }
    bCtx.fillStyle = textColor;
    bCtx.fillText(line, x, y);
  }

  // restore shadow/glow contexts
  bCtx.restore();
  // watermark
  bCtx.font = '14px Inter';
  bCtx.fillStyle = 'rgba(255,255,255,0.5)';
  bCtx.fillText('Fluxo âœ¦ Abhiii', cw - 110, ch - 18);
}

/* helper: roundRect */
function roundRect(ctx, x, y, w, h, r, fill, stroke) {
  if (typeof r === 'undefined') r = 5;
  if (typeof r === 'number') r = {tl: r, tr: r, br: r, bl: r};
  ctx.beginPath();
  ctx.moveTo(x + r.tl, y);
  ctx.lineTo(x + w - r.tr, y);
  ctx.quadraticCurveTo(x + w, y, x + w, y + r.tr);
  ctx.lineTo(x + w, y + h - r.br);
  ctx.quadraticCurveTo(x + w, y + h, x + w - r.br, y + h);
  ctx.lineTo(x + r.bl, y + h);
  ctx.quadraticCurveTo(x, y + h, x, y + h - r.bl);
  ctx.lineTo(x, y + r.tl);
  ctx.quadraticCurveTo(x, y, x + r.tl, y);
  ctx.closePath();
  if (fill) ctx.fill();
  if (stroke) ctx.stroke();
}

/* convert hex to rgba */
function hexToRgba(hex, alpha){
  hex = hex.replace('#','');
  if(hex.length===3) hex = hex.split('').map(h=>h+h).join('');
  const r = parseInt(hex.substr(0,2),16);
  const g = parseInt(hex.substr(2,2),16);
  const b = parseInt(hex.substr(4,2),16);
  return `rgba(${r},${g},${b},${alpha})`;
}
function shadeColor(hex, percent) {
  // small shade: percent -6..0..6
  try {
    if(!hex) return hex;
    hex = hex.replace('#','');
    if(hex.length===3) hex = hex.split('').map(h=>h+h).join('');
    const num = parseInt(hex,16);
    let r = (num >> 16) + percent;
    let g = ((num >> 8) & 0x00FF) + percent;
    let b = (num & 0x0000FF) + percent;
    r = Math.max(0, Math.min(255, r));
    g = Math.max(0, Math.min(255, g));
    b = Math.max(0, Math.min(255, b));
    return `rgb(${r},${g},${b})`;
  } catch(e){ return hex; }
}

/* export */
bratDownload.addEventListener('click', async ()=>{
  // hide UI elements (class hide-for-export)
  document.querySelectorAll('.hide-for-export').forEach(el=> el.style.opacity = '0');
  // small delay so UI faded
  await new Promise(r=>setTimeout(r,220));
  // capture canvas area only
  const preview = document.getElementById('brat-preview');
  // temporarily enlarge to high resolution export by scaling canvas
  const dataUrl = bratCanvas.toDataURL('image/png', 1.0);
  downloadDataUrl(dataUrl, `fluxo-brat-${Date.now()}.png`);
  // restore UI
  document.querySelectorAll('.hide-for-export').forEach(el=> el.style.opacity = '1');
});

/* utility */
function downloadDataUrl(dataUrl, filename){
  const a = document.createElement('a');
  a.href = dataUrl;
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  a.remove();
}

/* initial render */
bratText.value = bratConfig.text;
renderBrat();

/* ==========================
   Studio: basic image uploader + export
   (keeps simple: add text overlay as a single layer)
   ========================== */
const studioCanvas = document.getElementById('studioCanvas');
const sCtx = studioCanvas.getContext('2d');
const fileInput = document.getElementById('fileInput');
const layersEl = document.getElementById('layers');
let studioImage = null;
let studioTexts = [];

fileInput.addEventListener('change', (e)=>{
  const f = e.target.files[0];
  if(!f) return;
  const url = URL.createObjectURL(f);
  const img = new Image();
  img.onload = ()=> {
    studioImage = img;
    renderStudio();
  };
  img.src = url;
});

document.getElementById('addTextBtn').addEventListener('click', ()=>{
  const t = prompt('Enter text to add to canvas (new line allowed):');
  if(!t) return;
  studioTexts.push({text:t, x:50, y:80, size:28, color:'#ffffff'});
  renderStudio();
  refreshLayers();
});

document.getElementById('exportStudio').addEventListener('click', ()=>{
  const dataUrl = studioCanvas.toDataURL('image/png');
  downloadDataUrl(dataUrl, `fluxo-studio-${Date.now()}.png`);
});

function renderStudio(){
  const cw = studioCanvas.width = Math.min(1600, Math.max(700, document.getElementById('studioArea').clientWidth));
  const ch = studioCanvas.height = 420;
  sCtx.clearRect(0,0,cw,ch);
  // bg
  sCtx.fillStyle = 'rgba(10,12,18,0.6)';
  sCtx.fillRect(0,0,cw,ch);
  if(studioImage){
    // fit image into canvas preserving aspect
    const ratio = Math.min(cw/studioImage.width, ch/studioImage.height);
    const iw = studioImage.width * ratio;
    const ih = studioImage.height * ratio;
    const ix = (cw - iw)/2;
    const iy = (ch - ih)/2;
    sCtx.drawImage(studioImage, ix, iy, iw, ih);
  } else {
    // placeholder
    sCtx.fillStyle = 'rgba(255,255,255,0.02)';
    sCtx.fillRect(20,20,cw-40,ch-40);
    sCtx.fillStyle = 'rgba(255,255,255,0.06)';
    sCtx.font = '16px Inter';
    sCtx.fillText('Upload an image to begin editing', 36, 56);
  }
  // texts
  for(let i=0;i<studioTexts.length;i++){
    const t = studioTexts[i];
    sCtx.font = `${t.size}px Inter`;
    sCtx.fillStyle = t.color;
    sCtx.fillText(t.text, t.x, t.y);
  }
  refreshLayers();
}

function refreshLayers(){
  layersEl.innerHTML = '';
  studioTexts.forEach((t, idx)=>{
    const d = document.createElement('div'); d.className='layer';
    d.innerHTML = `<div>${t.text}</div><div style="display:flex;gap:8px"><button class="small-btn" data-idx="${idx}" onclick="removeText(this)">Remove</button></div>`;
    layersEl.appendChild(d);
  });
}
window.removeText = function(btn){
  const idx = Number(btn.dataset.idx);
  studioTexts.splice(idx,1);
  renderStudio();
};

renderStudio();

/* little helpers */
document.getElementById('goto-studio').addEventListener('click', ()=> {
  // scroll to studio area
  document.getElementById('studioArea').scrollIntoView({behavior:'smooth'});
});

/* EOF */
</script>

</body>
</html>
