<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Fluxo â€” Make Your Edits Flowww âœ¦ Abhiii</title>

<!-- Google fonts used -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&family=Montserrat:wght@400;700&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">

<!-- html2canvas for exporting -->
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<style>
  :root{
    --bg-1:#071224; --bg-2:#0b2233;
    --accent:#60a5fa; --accent2:#a78bfa; --muted:#94a3b8;
    --glass: rgba(255,255,255,0.04);
    --card: rgba(255,255,255,0.03);
    --radius:14px;
    --text:#e6eef8;
    --accent-strong: #ff66b3;
  }
  /* Themeable variants (swapped by JS) */
  .theme-pink { --accent:#ff7ab6; --accent2:#ffb3d9; --card: rgba(255,255,255,0.03); --bg-1:#120417; --bg-2:#2b0a22; }
  .theme-green{ --accent:#34d399; --accent2:#60a5fa; --bg-1:#051214; --bg-2:#051f14;}
  .theme-dark{ --accent:#60a5fa; --accent2:#a78bfa; --bg-1:#071224; --bg-2:#0b2233; }
  .theme-golden{ --accent:#f59e0b; --accent2:#f97316; --bg-1:#0f0b05; --bg-2:#2b1f0b; }

  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial;color:var(--text);background:linear-gradient(180deg,var(--bg-1),var(--bg-2));-webkit-font-smoothing:antialiased}
  a{color:inherit}
  /* background canvas */
  canvas#bg { position:fixed; inset:0; z-index:0; display:block; }

  /* app container */
  .wrap{position:relative;z-index:2;min-height:100vh;display:flex;flex-direction:column;align-items:stretch;}
  header.hero{display:flex;align-items:center;justify-content:space-between;padding:28px 6vw 20px;gap:20px}
  .brand {font-family: "Playfair Display", serif; font-size:28px; background:linear-gradient(90deg,var(--accent),var(--accent2)); -webkit-background-clip:text; color:transparent; letter-spacing:0.6px}
  .tag {color:var(--muted); font-size:13px}
  .controls-top{display:flex;gap:12px;align-items:center}

  /* central content */
  .main { max-width:1200px; margin:18px auto; width:94%; display:grid; grid-template-columns: 1fr 420px; gap:24px; align-items:start; padding-bottom:40px}
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:var(--radius); padding:18px; box-shadow: 0 12px 30px rgba(0,0,0,0.45); border:1px solid rgba(255,255,255,0.03);}

  /* landing / entry */
  .landing{display:flex;flex-direction:column;gap:12px}
  .lead { font-size:20px; color:#dff3ff }
  .sublead { color:var(--muted); font-size:13px }

  .entry-buttons { display:flex; gap:12px; margin-top:10px }
  .btn { background:linear-gradient(90deg,var(--accent),var(--accent2)); border:none; color:#041025; padding:10px 14px; border-radius:10px; font-weight:700; cursor:pointer; box-shadow:0 8px 20px rgba(0,0,0,0.45) }
  .ghost { background:transparent; border:1px solid rgba(255,255,255,0.06); color:var(--text); padding:9px 12px; border-radius:10px; cursor:pointer }

  /* Theme selector */
  .theme-select { display:flex; gap:8px; align-items:center }
  .theme-dot { width:28px; height:28px; border-radius:8px; cursor:pointer; border:2px solid rgba(0,0,0,0.15) }

  /* Brat section - separate animated opening */
  .brat-shell { margin-top:18px }
  .brat-panel { overflow:hidden; border-radius:12px; position:relative }
  .brat-opening { display:flex; align-items:center; justify-content:space-between; gap:12px; padding:16px; cursor:pointer; transition:transform .28s; border-radius:12px }
  .brat-opening:hover { transform:translateY(-4px) }
  .brat-animated { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; pointer-events:none; opacity:0; transform:scale(.98); transition:all .45s ease }
  .brat-animated.show { opacity:1; transform:scale(1) }

  /* Brat editor */
  .brat-editor { display:grid; grid-template-columns: 1fr 380px; gap:14px; align-items:start; margin-top:12px }
  .preview { background:linear-gradient(180deg,rgba(0,0,0,0.18),transparent); border-radius:12px; height:360px; display:flex; align-items:center; justify-content:center; position:relative; overflow:hidden; }
  .preview canvas, .preview .previewLayer { width:100%; height:100%; display:block }
  .brat-controls { display:flex; flex-direction:column; gap:10px }
  .label{ font-size:13px; color:var(--muted); margin-bottom:6px;}
  input[type="text"], select { width:100%; padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,0.04); background:rgba(255,255,255,0.01); color:var(--text) }

  .swatches { display:flex; gap:8px; flex-wrap:wrap }
  .swatch { width:36px; height:36px; border-radius:8px; cursor:pointer; border:2px solid rgba(255,255,255,0.03); position:relative }

  .swatch.locked::after {
    content: "ðŸ”’";
    position:absolute; right:4px; top:2px; font-size:12px; filter:drop-shadow(0 2px 3px rgba(0,0,0,0.5));
  }
  .swatch.pulse { box-shadow:0 6px 18px rgba(0,0,0,0.35); transform:scale(1); transition:transform .18s ease; }
  .swatch.pulse:hover{ transform:scale(1.06); }

  .toggle { display:flex; gap:8px; align-items:center }
  .small-btn { padding:8px 10px; border-radius:8px; background:rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.03); cursor:pointer }

  .export-row { display:flex; gap:8px; margin-top:10px; align-items:center }

  /* Studio removed (we keep only brat) - right column used for extra controls/info */
  .studio-note { font-size:13px; color:var(--muted); margin-top:8px; }

  /* footer */
  footer.sitefoot { text-align:center; padding:22px 10px; color:var(--muted); border-top:1px solid rgba(255,255,255,0.02); margin-top:24px }

  /* small screens */
  @media(max-width:980px){
    .main { grid-template-columns:1fr; }
    .brat-editor { grid-template-columns: 1fr; }
  }

  /* generate overlay (used while exporting) */
  .export-clean {
    position:fixed; inset:0; background:transparent; display:flex; align-items:center; justify-content:center; z-index:9999;
  }
  .hidden { display:none !important; }

  .muted{ color:var(--muted); font-size:13px }
  .tiny{ font-size:12px }
</style>
</head>
<body class="theme-dark">

<!-- background canvas -->
<canvas id="bg"></canvas>

<div class="wrap">
  <header class="hero">
    <div>
      <div class="brand">Fluxo <span style="font-weight:400; font-size:12px; color:var(--muted)">âœ¦ make your edits flowww</span></div>
      <div class="tag muted">Crafted with ðŸ’– by Abhiii â€” for the meme geeks</div>
    </div>

    <div class="controls-top">
      <div class="theme-select" title="Switch UI theme (visual)">
        <div class="muted tiny" style="margin-right:8px">Themes</div>
        <div class="theme-dot" title="Pink" style="background:linear-gradient(90deg,#ff7ab6,#ffb3d9)" data-theme="theme-pink"></div>
        <div class="theme-dot" title="Green" style="background:linear-gradient(90deg,#34d399,#60a5fa)" data-theme="theme-green"></div>
        <div class="theme-dot" title="Dark" style="background:linear-gradient(90deg,#60a5fa,#a78bfa)" data-theme="theme-dark"></div>
        <div class="theme-dot" title="Golden" style="background:linear-gradient(90deg,#f59e0b,#f97316)" data-theme="theme-golden"></div>
      </div>
      <button class="ghost" id="open-brat">Open Brat Lab</button>
      <button class="btn" id="goto-studio">Open Brat Studio</button>
    </div>
  </header>

  <main class="main">
    <!-- LEFT: Landing + Brat -->
    <div>
      <div class="card landing">
        <div class="lead">Fluxo â€” Brat Lab & Meme Studio</div>
        <div class="sublead">Create trendy brat text art, and powerful meme edits â€” professional UI, local export, responsive.</div>
      </div>

      <!-- BRAT Shell -->
      <div class="card brat-shell" id="brat-shell">
        <div class="brat-panel">
          <!-- opening bar -->
          <div class="brat-opening" id="brat-opening">
            <div>
              <div style="font-weight:700">Brat Generator Lab</div>
              <div class="muted tiny">Animated text art â€” fonts, colors, glow & export</div>
            </div>
            <div class="muted tiny">Click to open</div>
          </div>

          <!-- animated decorative layer -->
          <div class="brat-animated" id="brat-anim">
            <!-- subtle animated glow circles (decorative) -->
            <svg width="320" height="120" viewBox="0 0 320 120" fill="none" aria-hidden>
              <defs>
                <linearGradient id="g1" x1="0" x2="1">
                  <stop offset="0" stop-color="rgba(255,255,255,0.06)"/>
                  <stop offset="1" stop-color="transparent"/>
                </linearGradient>
              </defs>
              <rect x="0" y="10" width="320" height="100" rx="12" fill="url(#g1)"></rect>
            </svg>
          </div>

          <!-- editor (hidden until open) -->
          <div id="brat-editor" style="display:none; padding:14px;">
            <div class="brat-editor">
              <!-- left: live preview -->
              <div>
                <div class="label">Live Preview</div>
                <div class="preview" id="brat-preview">
                  <div id="previewLayer" style="pointer-events:none; display:flex; align-items:center; justify-content:center; text-align:center; padding:20px;">
                    <canvas id="bratCanvas" width="800" height="360"></canvas>
                  </div>
                </div>

                <div style="display:flex; gap:8px; margin-top:8px; align-items:center">
                  <button class="small-btn" id="brat-random">Random</button>
                  <button class="small-btn" id="brat-generate">Generate (Download)</button>
                  <div class="muted tiny" style="margin-left:auto">Watermark: Fluxo âœ¦ Abhiii</div>
                </div>
                <div class="muted tiny" style="margin-top:8px">
                  Daily free generates left: <strong id="daily-left">2</strong> Â· Pro unlock: <strong id="pro-status">no</strong>
                </div>
              </div>

              <!-- right: controls -->
              <div class="brat-controls">
                <div>
                  <div class="label">Text</div>
                  <input type="text" id="bratText" placeholder="Type your brat line â€” e.g., 'itâ€™s giving main character vibes ðŸ’…'">
                </div>

                <div>
                  <div class="label">Font</div>
                  <select id="bratFont">
                    <option value="48px Inter">Inter (clean)</option>
                    <option value="56px 'Playfair Display'">Playfair (elegant)</option>
                    <option value="54px 'Montserrat'">Montserrat (bold)</option>
                    <option value="48px 'Courier New'">Mono (retro)</option>
                    <option value="56px 'Segoe UI'">Segoe UI</option>
                  </select>
                </div>

                <div>
                  <div class="label">Color</div>
                  <div class="swatches" id="bratColors">
                    <!-- free color swatches (always enabled) -->
                    <div class="swatch pulse" data-color="#ffe6f0" style="background:linear-gradient(90deg,#ffedf6,#ffe6f0)"></div>
                    <div class="swatch pulse" data-color="#e6f0ff" style="background:linear-gradient(90deg,#e6f0ff,#eff6ff)"></div>
                    <div class="swatch pulse" data-color="#eafaf1" style="background:linear-gradient(90deg,#eefff7,#eafaf1)"></div>
                    <div class="swatch pulse" data-color="#fff3e0" style="background:linear-gradient(90deg,#fff6eb,#fff3e0)"></div>
                    <div class="swatch pulse" data-color="#e6eef8" style="background:linear-gradient(90deg,#f0f6ff,#e6eef8)"></div>
                  </div>
                </div>

                <div>
                  <div class="label">Background (free options)</div>
                  <div class="swatches" id="bratBGs">
                    <div class="swatch pulse" data-bg="linear-gradient(90deg,#fff3f8,#ffe6f0)" style="background:linear-gradient(90deg,#fff3f8,#ffe6f0)"></div>
                    <div class="swatch pulse" data-bg="linear-gradient(90deg,#e6f0ff,#eff6ff)" style="background:linear-gradient(90deg,#e6f0ff,#eff6ff)"></div>
                    <div class="swatch pulse" data-bg="linear-gradient(90deg,#f1f5f9,#e2e8f0)" style="background:linear-gradient(90deg,#f1f5f9,#e2e8f0)"></div>
                    <div class="swatch pulse" data-bg="#0f172a" style="background:linear-gradient(90deg,#161616,#0b0b0b)"></div>
                    <div class="swatch pulse" data-bg="linear-gradient(90deg,#fff7ed,#fff1e6)" style="background:linear-gradient(90deg,#fff7ed,#fff1e6)"></div>
                  </div>
                </div>

                <div>
                  <div class="label">Premium backgrounds (Pro only)</div>
                  <div class="swatches" id="bratPremiumBGs">
                    <!-- locked pro swatches -->
                    <div class="swatch locked" data-bg="linear-gradient(90deg,#0b1020,#0b1f3a)"></div>
                    <div class="swatch locked" data-bg="linear-gradient(90deg,#0f0212,#2a0029)"></div>
                    <div class="swatch locked" data-bg="linear-gradient(90deg,#0b1f0b,#052614)"></div>
                    <div class="swatch locked" data-bg="linear-gradient(90deg,#fff4e6,#ffeded)"></div>
                    <div class="swatch locked" data-bg="linear-gradient(90deg,#eaf8ff,#dbeafe)"></div>
                    <div class="swatch locked" data-bg="linear-gradient(90deg,#f0e6ff,#fdeef8)"></div>
                    <div class="swatch locked" data-bg="linear-gradient(90deg,#0b0f20,#06102a)"></div>
                    <div class="swatch locked" data-bg="linear-gradient(90deg,#3b3b3b,#1f1f1f)"></div>
                  </div>
                  <div class="muted tiny" style="margin-top:6px">Unlock pro with a daily password to access extra swatches & features.</div>
                </div>

                <div>
                  <div class="label">Effects</div>
                  <div class="toggle">
                    <label><input type="checkbox" id="bratGlow"> Glow</label>
                    <label><input type="checkbox" id="bratOutline"> Outline</label>
                    <label><input type="checkbox" id="bratShadow"> Shadow</label>
                  </div>
                </div>

                <div style="margin-top:auto">
                  <div class="label">Size / Align</div>
                  <div style="display:flex; gap:8px; align-items:center">
                    <input id="bratSize" type="range" min="28" max="120" value="56" />
                    <select id="bratAlign">
                      <option value="center">Center</option>
                      <option value="left">Left</option>
                      <option value="right">Right</option>
                    </select>
                  </div>
                </div>

                <!-- Pro unlock UI -->
                <div style="margin-top:12px; display:flex; gap:8px; align-items:center;">
                  <button class="btn" id="unlock-pro-btn">Unlock Pro (daily)</button>
                  <button class="ghost" id="pro-info">Pro info</button>
                </div>
              </div>
            </div>
          </div>

        </div>
      </div>

      <!-- extra informational card -->
      <div class="card" style="margin-top:14px">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <div style="font-weight:700">Fluxo Labs</div>
            <div class="muted tiny">Pro features, local export, responsive UI â€” no backend required</div>
          </div>
          <div class="muted tiny">Version v4.0</div>
        </div>
      </div>
    </div>

    <!-- RIGHT: Controls / info -->
    <aside class="card studio">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div style="font-weight:700">Brat Studio Controls</div>
        <div class="muted tiny">Fast local generation</div>
      </div>

      <div style="height:12px"></div>

      <div class="studio-note">
        Tip: Use the **Generate (Download)** button â€” the page will create a clean screenshot (UI hidden). Free users: 2 generates/day. Use the daily password to unlock Pro for the day.
      </div>

      <div style="margin-top:12px">
        <div class="label">Account / Limit</div>
        <div class="muted tiny" id="limit-info">Daily used: 0 Â· Left: 2</div>
      </div>

      <div style="margin-top:12px">
        <div class="label">Quick presets</div>
        <div style="display:flex;gap:8px;margin-top:8px">
          <button class="small-btn" data-preset="itâ€™s giving main character vibes ðŸ’…">Main character</button>
          <button class="small-btn" data-preset="mood: sorry not sorry">Mood</button>
          <button class="small-btn" data-preset="When the wifi dies but your vibe stays">Relatable</button>
        </div>
      </div>

    </aside>

  </main>

  <footer class="sitefoot">crafted with ðŸ’– by Abhiii for the meme geeks</footer>
</div>

<!-- export-clean overlay (hidden) -->
<div id="export-clean" class="export-clean hidden"></div>

<script>
/* ========= CONFIG ========= */
const DAILY_LIMIT = 2;
const PRO_PASSWORD = "ABHIJEET0123";

/* ========= UTIL & STATE (localStorage keys) ========= */
const LS_KEYS = {
  dailyDate: 'fluxo_daily_date',        // last date string e.g. "2025-11-07"
  dailyCount: 'fluxo_daily_count',      // integer
  proDate: 'fluxo_pro_unlocked_date'    // date string for which pro unlocked
};

function todayKey(){ // local date string yyyy-mm-dd
  const d = new Date();
  return d.getFullYear() + '-' + String(d.getMonth()+1).padStart(2,'0') + '-' + String(d.getDate()).padStart(2,'0');
}
function getDailyCount(){
  const date = localStorage.getItem(LS_KEYS.dailyDate);
  if(date !== todayKey()){ localStorage.setItem(LS_KEYS.dailyDate, todayKey()); localStorage.setItem(LS_KEYS.dailyCount, '0'); return 0; }
  return Number(localStorage.getItem(LS_KEYS.dailyCount) || '0');
}
function incDailyCount(){
  const c = getDailyCount() + 1;
  localStorage.setItem(LS_KEYS.dailyCount, String(c));
  localStorage.setItem(LS_KEYS.dailyDate, todayKey());
  return c;
}
function getProUnlockedForToday(){
  return localStorage.getItem(LS_KEYS.proDate) === todayKey();
}
function unlockProForToday(){
  localStorage.setItem(LS_KEYS.proDate, todayKey());
}
function clearPro(){ localStorage.removeItem(LS_KEYS.proDate); }

/* ========= DOM refs ========= */
const openBratBtn = document.getElementById('open-brat');
const bratOpening = document.getElementById('brat-opening');
const bratEditor = document.getElementById('brat-editor');
const bratAnim = document.getElementById('brat-anim');
const bratCanvas = document.getElementById('bratCanvas');
const bratText = document.getElementById('bratText');
const bratFont = document.getElementById('bratFont');
const bratColors = document.getElementById('bratColors');
const bratBGs = document.getElementById('bratBGs');
const bratPremiumBGs = document.getElementById('bratPremiumBGs');
const bratSize = document.getElementById('bratSize');
const bratAlign = document.getElementById('bratAlign');
const bratGlow = document.getElementById('bratGlow');
const bratOutline = document.getElementById('bratOutline');
const bratShadow = document.getElementById('bratShadow');
const bratGenerate = document.getElementById('brat-generate');
const bratRandom = document.getElementById('brat-random');
const dailyLeftEl = document.getElementById('daily-left');
const proStatusEl = document.getElementById('pro-status');
const limitInfo = document.getElementById('limit-info');
const unlockProBtn = document.getElementById('unlock-pro-btn');
const proInfoBtn = document.getElementById('pro-info');
const exportClean = document.getElementById('export-clean');

/* ========= Canvas setup ========= */
const ctx = bratCanvas.getContext('2d');
function fitCanvasToDisplay(){
  // keep internal 1600x720 ratio but scale to CSS for crispness if needed
  // we'll draw at devicePixelRatio scaled resolution
  const DPR = Math.max(1, window.devicePixelRatio || 1);
  const w = 800;
  const h = 360;
  bratCanvas.width = w * DPR;
  bratCanvas.height = h * DPR;
  bratCanvas.style.width = w + 'px';
  bratCanvas.style.height = h + 'px';
  ctx.setTransform(DPR,0,0,DPR,0,0);
}
fitCanvasToDisplay();
window.addEventListener('resize', fitCanvasToDisplay);

/* ========= Default config ========= */
let cfg = {
  text: "itâ€™s giving main character vibes ðŸ’…",
  font: bratFont.value,
  color: "#ffe6f0",
  bg: "linear-gradient(90deg,#fff3f8,#ffe6f0)",
  size: Number(bratSize.value),
  align: 'center',
  glow:false, outline:false, shadow:false,
  proUnlocked: getProUnlockedForToday()
};

/* ========= helpers ========= */
function applyCfgFromControls(){
  cfg.text = bratText.value || cfg.text;
  cfg.font = bratFont.value;
  cfg.size = Number(bratSize.value);
  cfg.align = bratAlign.value;
  cfg.glow = bratGlow.checked;
  cfg.outline = bratOutline.checked;
  cfg.shadow = bratShadow.checked;
}
function setDailyUI(){
  const used = getDailyCount();
  const left = Math.max(0, DAILY_LIMIT - used);
  dailyLeftEl.textContent = left;
  limitInfo.textContent = `Daily used: ${used} Â· Left: ${left}`;
  proStatusEl.textContent = cfg.proUnlocked ? 'yes' : 'no';
}

/* ========= Render function ========= */
function renderBrat(){
  applyCfgFromControls();
  // parse bg: either solid color or gradient stored as string
  // draw background
  const bgStr = cfg.bg;
  // simple gradients support (we directly parse for linear-gradient(...))
  if(bgStr && bgStr.startsWith('linear-gradient')){
    // quick CSS-to-canvas gradient approximation â€” parse colors inside parentheses
    const inside = bgStr.slice(bgStr.indexOf('(')+1, bgStr.lastIndexOf(')'));
    const parts = inside.split(',');
    // take last two color stops
    const c1 = parts[parts.length-2] ? parts[parts.length-2].trim() : '#fff';
    const c2 = parts[parts.length-1] ? parts[parts.length-1].trim() : '#eee';
    const g = ctx.createLinearGradient(0,0,bratCanvas.width/bratCanvas.style.width*1, bratCanvas.height/bratCanvas.style.height*1);
    g.addColorStop(0, c1); g.addColorStop(1, c2);
    ctx.fillStyle = g;
  } else {
    ctx.fillStyle = cfg.bg || '#0f172a';
  }
  // clear & fill
  const wpx = parseInt(bratCanvas.style.width);
  const hpx = parseInt(bratCanvas.style.height);
  ctx.clearRect(0,0,wpx,hpx);
  ctx.fillRect(0,0,wpx,hpx);

  // draw optional background pattern for pro (subtle)
  if(cfg.proUnlocked){
    ctx.save();
    ctx.globalAlpha = 0.04;
    ctx.fillStyle = '#ffffff';
    for(let i=0;i<30;i++){
      ctx.fillRect((i*37)%wpx, (i*13)%hpx, 8, 8);
    }
    ctx.restore();
  }

  // draw text
  const fontSpec = cfg.font.split(' ')[0] + ' ' + cfg.size + 'px';
  // For fonts with spaces we've provided quotes. Use approximate family.
  ctx.font = `${cfg.size}px ${cfg.font.includes("'") ? cfg.font.split("'")[1] : cfg.font.split(' ')[1] || 'Inter'}`;
  ctx.textAlign = cfg.align;
  ctx.textBaseline = 'middle';
  // compute position based on align
  let x = (cfg.align === 'left') ? 40 : (cfg.align === 'right') ? (wpx - 40) : (wpx/2);
  const y = hpx/2;

  // shadow
  if(cfg.shadow){
    ctx.save();
    ctx.shadowColor = "rgba(0,0,0,0.45)";
    ctx.shadowBlur = 18;
    ctx.shadowOffsetY = 4;
    ctx.fillStyle = cfg.color;
    ctx.fillText(cfg.text, x, y);
    ctx.restore();
  }

  // outline
  if(cfg.outline){
    ctx.lineWidth = Math.max(2, Math.round(cfg.size/18));
    ctx.strokeStyle = '#0b0b0b';
    ctx.strokeText(cfg.text, x, y);
  }

  // glow (draw multiple translucent layers)
  if(cfg.glow){
    ctx.save();
    for(let i=6;i>=1;i--){
      ctx.globalAlpha = 0.04;
      ctx.shadowColor = cfg.color;
      ctx.shadowBlur = i*8;
      ctx.fillStyle = cfg.color;
      ctx.fillText(cfg.text, x, y);
    }
    ctx.restore();
  }

  // final solid text
  ctx.fillStyle = cfg.color;
  ctx.fillText(cfg.text, x, y);
}

/* ========= Randomize helper ========= */
function randomizeBrat(){
  const sampleTexts = [
    "itâ€™s giving main character vibes ðŸ’…",
    "mood: sorry not sorry",
    "When the wifi dies but your vibe stays",
    "vibe check: immaculate",
    "I paused my responsibilities for this look"
  ];
  bratText.value = sampleTexts[Math.floor(Math.random()*sampleTexts.length)];
  bratFont.value = ["48px Inter","56px 'Playfair Display'","54px 'Montserrat'","48px 'Courier New'","56px 'Segoe UI'"][Math.floor(Math.random()*5)];
  bratSize.value = [48,56,64,42,72][Math.floor(Math.random()*5)];
  // pick random free bg
  const bgs = Array.from(bratBGs.querySelectorAll('.swatch'));
  const pick = bgs[Math.floor(Math.random()*bgs.length)];
  if(pick) cfg.bg = pick.dataset.bg || pick.style.background;
  cfg.color = ["#ffe6f0","#e6f0ff","#eafaf1","#fff3e0","#e6eef8"][Math.floor(Math.random()*5)];
  bratGlow.checked = Math.random() > 0.6;
  bratOutline.checked = Math.random() > 0.75;
  bratShadow.checked = Math.random() > 0.45;
  applyCfgFromControls();
  renderBrat();
}

/* ========= Swatch click handlers ========= */
function initSwatches(){
  // free color swatches
  bratColors.querySelectorAll('.swatch').forEach(s => {
    s.addEventListener('click', ()=>{
      cfg.color = s.dataset.color;
      renderBrat();
    });
  });
  // free bg swatches
  bratBGs.querySelectorAll('.swatch').forEach(s => {
    s.addEventListener('click', ()=>{
      cfg.bg = s.dataset.bg || s.style.background;
      renderBrat();
    });
  });
  // premium bg swatches (locked unless pro)
  bratPremiumBGs.querySelectorAll('.swatch').forEach(s => {
    s.addEventListener('click', ()=>{
      if(!cfg.proUnlocked){
        alert('This background is Pro-only. Unlock Pro for the day with the daily password.');
        return;
      }
      // if unlocked, use it
      s.classList.remove('locked');
      cfg.bg = s.dataset.bg || s.style.background;
      renderBrat();
    });
  });
}

/* ========= Open / UI toggles ========= */
openBratBtn.addEventListener('click', ()=> openEditor());
bratOpening.addEventListener('click', ()=> openEditor());
function openEditor(){
  bratEditor.style.display = bratEditor.style.display === 'none' ? 'block' : 'none';
  bratAnim.classList.toggle('show');
  renderBrat();
}

/* ========= Pro unlock flow ========= */
unlockProBtn.addEventListener('click', async ()=>{
  const pass = prompt('Enter daily Pro password (ask Abhii):');
  if(!pass) return;
  if(pass === PRO_PASSWORD){
    unlockProForToday();
    cfg.proUnlocked = true;
    updateProUI(true);
    alert('Pro unlocked for today ðŸŽ‰ â€” premium swatches & features are available.');
    renderBrat();
  } else {
    alert('Incorrect password.');
  }
});
proInfoBtn.addEventListener('click', ()=>{
  alert('Pro unlock: enter the daily password (ask Abhii). Pro unlock lasts for the day and resets at midnight. Pro enables additional backgrounds and visual extras.');
});

function updateProUI(forceState){
  cfg.proUnlocked = getProUnlockedForToday() || Boolean(forceState);
  // toggle locked class visibility
  bratPremiumBGs.querySelectorAll('.swatch').forEach(s=>{
    if(cfg.proUnlocked) s.classList.remove('locked'); else s.classList.add('locked');
  });
  setDailyUI();
}

/* ========= Generate / Export logic ========= */
async function generateDownload(){
  // check limit
  const used = getDailyCount();
  if(!cfg.proUnlocked && used >= DAILY_LIMIT){
    const want = confirm('Daily free generate limit reached (2). Unlock Pro for unlimited generates today?');
    if(want){ unlockProBtn.click(); }
    return;
  }
  // increment now (we count attempt as used)
  const newCount = incDailyCount();
  setDailyUI();

  // Hide UI elements for clean capture:
  const hideSelectors = [
    '.controls-top', '.brat-opening', '.brat-controls .label', '.muted.tiny', '.theme-select', '.studio-note', '.small-btn'
  ];
  const hiddenEls = [];
  hideSelectors.forEach(sel => {
    document.querySelectorAll(sel).forEach(el => {
      if(el && !el.classList.contains('fluxo-hide')){ el.classList.add('fluxo-hide'); hiddenEls.push(el); el.style.visibility='hidden'; }
    });
  });
  // hide borders & cards for cleaner shot
  document.querySelectorAll('.card').forEach(c=>{ c.dataset.orig = c.style.border; c.style.border='0'; });

  // optionally show only canvas in center
  exportClean.classList.remove('hidden');
  exportClean.innerHTML = ''; // keep blank background

  // Wait a tick to let DOM settle
  await new Promise(r=>setTimeout(r,120));

  // take screenshot of the preview canvas area (we can render the canvas directly)
  try{
    // For safety, render the Canvas to dataURL directly (higher quality)
    const dataUrl = bratCanvas.toDataURL('image/png');
    // trigger download
    const a = document.createElement('a');
    a.href = dataUrl;
    a.download = `fluxo_brat_${todayKey()}_${new Date().getTime()}.png`;
    document.body.appendChild(a);
    a.click();
    a.remove();
  }catch(err){
    // fallback to html2canvas capture of preview element
    try{
      const previewEl = document.getElementById('brat-preview');
      const canvasSnapshot = await html2canvas(previewEl, {backgroundColor:null, scale:2});
      const url = canvasSnapshot.toDataURL('image/png');
      const a = document.createElement('a');
      a.href = url;
      a.download = `fluxo_brat_${todayKey()}_${new Date().getTime()}.png`;
      document.body.appendChild(a);
      a.click();
      a.remove();
    }catch(err2){
      console.error(err2);
      alert('Export failed â€” please try again.');
    }
  }finally{
    // restore UI
    hiddenEls.forEach(el=>{ el.style.visibility='visible'; el.classList.remove('fluxo-hide'); });
    document.querySelectorAll('.card').forEach(c=>{ c.style.border = c.dataset.orig || '1px solid rgba(255,255,255,0.03)'; });
    exportClean.classList.add('hidden');
    setDailyUI();
  }
}

bratGenerate.addEventListener('click', generateDownload);

/* ========= Init & wiring ========= */
initSwatches();
updateProUI();
renderBrat();
setDailyUI();

/* bind controls */
bratText.addEventListener('input', ()=> { renderBrat(); });
bratFont.addEventListener('change', ()=> { renderBrat(); });
bratSize.addEventListener('input', ()=> { renderBrat(); });
bratAlign.addEventListener('change', ()=> { renderBrat(); });
bratGlow.addEventListener('change', ()=> { renderBrat(); });
bratOutline.addEventListener('change', ()=> { renderBrat(); });
bratShadow.addEventListener('change', ()=> { renderBrat(); });
bratRandom.addEventListener('click', ()=> { randomizeBrat(); });

/* quick presets from right column */
document.querySelectorAll('.small-btn[data-preset]').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    bratText.value = btn.dataset.preset;
    renderBrat();
  });
});

/* theme selector */
document.querySelectorAll('.theme-dot').forEach(el=>{
  el.addEventListener('click', ()=> {
    const theme = el.dataset.theme;
    document.body.className = theme;
  });
});

/* background particle canvas (subtle) */
const bg = document.getElementById('bg');
const bgCtx = bg.getContext('2d');
let DPR = Math.max(1, window.devicePixelRatio || 1);
function resizeBg(){ DPR = Math.max(1, window.devicePixelRatio || 1); bg.width = innerWidth * DPR; bg.height = innerHeight * DPR; bg.style.width = innerWidth + 'px'; bg.style.height = innerHeight + 'px'; bgCtx.setTransform(DPR,0,0,DPR,0,0); }
window.addEventListener('resize', resizeBg);
resizeBg();
const PCOUNT = Math.max(12, Math.floor((innerWidth*innerHeight)/400000));
const PARTS = [];
for(let i=0;i<PCOUNT;i++){
  PARTS.push({x:Math.random()*innerWidth, y:Math.random()*innerHeight, r:1+Math.random()*2.6, vx:(Math.random()-0.5)*0.15, vy:(Math.random()-0.5)*0.15, hue:200+Math.random()*140});
}
let mouse = {x:innerWidth/2, y:innerHeight/2};
window.addEventListener('mousemove', e => { mouse.x = e.clientX; mouse.y = e.clientY; });
function drawBg(){
  bgCtx.clearRect(0,0,innerWidth,innerHeight);
  // subtle gradient
  const g = bgCtx.createLinearGradient(0,0,innerWidth,innerHeight);
  g.addColorStop(0, 'rgba(6,12,24,0.08)');
  g.addColorStop(1, 'rgba(12,30,46,0.12)');
  bgCtx.fillStyle = g; bgCtx.fillRect(0,0,innerWidth,innerHeight);
  for(let p of PARTS){
    p.x += p.vx + (mouse.x - p.x) * 0.0004;
    p.y += p.vy + (mouse.y - p.y) * 0.0004;
    if(p.x < -50) p.x = innerWidth + 50; if(p.x > innerWidth + 50) p.x = -50;
    if(p.y < -50) p.y = innerHeight + 50; if(p.y > innerHeight + 50) p.y = -50;
    const gr = bgCtx.createRadialGradient(p.x,p.y,0,p.x,p.y,p.r*10);
    gr.addColorStop(0, 'rgba(167,139,250,0.06)'); gr.addColorStop(1, 'rgba(96,165,250,0.01)');
    bgCtx.fillStyle = gr;
    bgCtx.beginPath(); bgCtx.arc(p.x,p.y,p.r,0,Math.PI*2); bgCtx.fill();
  }
  requestAnimationFrame(drawBg);
}
requestAnimationFrame(drawBg);

/* ========= Daily reset helper (runs at load, keeps midnight reset) ========= */
(function ensureDailyReset(){
  const storedDate = localStorage.getItem(LS_KEYS.dailyDate);
  if(storedDate !== todayKey()){
    localStorage.setItem(LS_KEYS.dailyDate, todayKey());
    localStorage.setItem(LS_KEYS.dailyCount, '0');
  }
  // also if pro date is older, it stays only for that date
  if(localStorage.getItem(LS_KEYS.proDate) !== todayKey()){
    // allow proDate to be stale, we just show locked
  }
  setDailyUI();
})();

/* ========= small UX niceties ========= */
document.addEventListener('keydown', (e)=>{
  if(e.key === 'Escape'){
    // hide editor if open
    if(bratEditor.style.display === 'block') { bratEditor.style.display = 'none'; bratAnim.classList.remove('show'); }
  }
});

</script>
</body>
</html>
